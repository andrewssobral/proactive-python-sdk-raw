function getSessionId(){return localStorage["pa.session"]}function getProperties($http,$location,UtilsFactory){return $http.get("resources/config.json").success(function(response){var pcaServiceUrl=angular.toJson(response.confServer.pcaServiceUrl,!0),schedulerRestUrl=angular.toJson(response.confServer.schedulerRestUrl,!0),rmRestUrl=angular.toJson(response.confServer.rmRestUrl,!0),notificationServiceUrl=angular.toJson(response.confServer.notificationServiceUrl,!0),catalogServiceUrl=angular.toJson(response.confServer.catalogServiceUrl,!0),wfAutomationQueryPeriod=angular.toJson(response.wfAutomationQueryPeriod,!0),workflowExecutionQueryPeriod=angular.toJson(response.workflowExecutionQueryPeriod,!0),cloudAutomationQueryPeriod=angular.toJson(response.cloudAutomationQueryPeriod,!0),wfAutomationLast24hHistoryPeriod=angular.toJson(response.wfAutomationLast24hHistoryPeriod,!0),cloudWatchPortalQueryPeriod=angular.toJson(response.cloudWatchPortalQueryPeriod,!0),jobAnalyticsPortalRefreshRate=angular.toJson(response.jobAnalyticsPortalRefreshRate,!0),notificationPortalQueryPeriod=angular.toJson(response.notificationPortalQueryPeriod,!0),genericCatalogPortalQueryPeriod=angular.toJson(response.genericCatalogPortalQueryPeriod,!0),jobPlannerQueryPeriod=angular.toJson(response.jobPlannerQueryPeriod,!0),appCatalogBucketsUrl=angular.toJson(response.confServer.catalogServiceUrl+"buckets",!0),appCatalogWorkflowsUrl=angular.toJson($location.$$protocol+"://"+$location.$$host+":"+$location.port()+"/catalog/buckets/"+response.view[0].catalog.bucketName+"/resources"),jobPlannerServiceUrl=angular.toJson(response.confServer.jobPlannerServiceUrl,!0),cloudWatchServiceUrl=angular.toJson(response.confServer.cloudWatchServiceUrl,!0),jobAnalyticsServiceUrl=angular.toJson(response.confServer.jobAnalyticsServiceUrl,!0),configViews=angular.toJson(response.view,!0),appUrl=angular.toJson($location.$$protocol+"://"+$location.$$host+":"+$location.port()),studioUrl=angular.toJson($location.$$protocol+"://"+$location.$$host+":"+$location.port()+"/studio"),restUrl=angular.toJson($location.$$protocol+"://"+$location.$$host+":"+$location.port()+"/rest"),schedulerPortalUrl=angular.toJson($location.$$protocol+"://"+$location.$$host+":"+$location.port()+"/scheduler"),proactiveLanguage=angular.toJson(response.proactiveLanguage,!0).replace(/"/g,"");localStorage.pcaServiceUrl=pcaServiceUrl,localStorage.schedulerRestUrl=schedulerRestUrl,localStorage.rmRestUrl=rmRestUrl,localStorage.notificationServiceUrl=notificationServiceUrl,localStorage.catalogServiceUrl=catalogServiceUrl,localStorage.genericCatalogPortalQueryPeriod=genericCatalogPortalQueryPeriod,localStorage.notificationPortalQueryPeriod=notificationPortalQueryPeriod,localStorage.cloudAutomationQueryPeriod=cloudAutomationQueryPeriod,localStorage.wfAutomationQueryPeriod=wfAutomationQueryPeriod,localStorage.workflowExecutionQueryPeriod=workflowExecutionQueryPeriod,localStorage.cloudWatchPortalQueryPeriod=cloudWatchPortalQueryPeriod,localStorage.wfAutomationLast24hHistoryPeriod=wfAutomationLast24hHistoryPeriod,localStorage.jobAnalyticsPortalRefreshRate=jobAnalyticsPortalRefreshRate,localStorage.jobPlannerQueryPeriod=jobPlannerQueryPeriod,localStorage.appCatalogWorkflowsUrl=appCatalogWorkflowsUrl,localStorage.appCatalogBucketsUrl=appCatalogBucketsUrl,localStorage.configViews=configViews,localStorage.jobPlannerServiceUrl=jobPlannerServiceUrl,localStorage.cloudWatchServiceUrl=cloudWatchServiceUrl,localStorage.jobAnalyticsServiceUrl=jobAnalyticsServiceUrl,localStorage.appUrl=appUrl,localStorage.restUrl=restUrl,localStorage.studioUrl=studioUrl,localStorage.schedulerPortalUrl=schedulerPortalUrl,localStorage.proactiveLanguage||(localStorage.proactiveLanguage=proactiveLanguage)}).error(function(response){console.error("LoadingPropertiesService $http.get error",status,response)})}function getCookie(name){for(var cookieName=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(cookieName))return c.substring(cookieName.length,c.length)}return null}function UtilsFactory($window,$uibModal,$filter,$cookies,$http,$rootScope,$q,$location,toaster,SweetAlert,$httpParamSerializerJQLike){function schedulerRestUrl(){return JSON.parse(localStorage.schedulerRestUrl)}function loadUserPreferences(itemName){return localStorage.WizardUserPreferences||localStorage.setItem("WizardUserPreferences",JSON.stringify(defaultUserPreferences)),JSON.parse(localStorage.WizardUserPreferences)}function getUserPreference(propertyName){var preferences=loadUserPreferences(),preference=getOrSetNestedObjectProperty(preferences,propertyName);return preference&&"object"!=typeof preference||"object"==typeof preference&&null!==preference&&!angular.equals(preference,{})?preference:preference=getOrSetNestedObjectProperty(defaultUserPreferences,propertyName)}function getSortClasses(sortParameters,column){return sortParameters&&sortParameters.column===column?"a"===sortParameters.order?"fa-sort-asc":"fa-sort-desc":"fa-sort text-disabled"}function setUserPreference(propertyName,value){var userPreferences=loadUserPreferences();return getOrSetNestedObjectProperty(userPreferences,propertyName,value),localStorage.setItem("WizardUserPreferences",JSON.stringify(userPreferences)),userPreferences}function getOrSetNestedObjectProperty(targetObject,path,value){for(var schema=targetObject,propertiesList=path.split("."),i=0;i<propertiesList.length-1;i++){var elem=propertiesList[i];schema[elem]||(schema[elem]={}),schema=schema[elem]}return void 0===value?schema[propertiesList[propertiesList.length-1]]:void(schema[propertiesList[propertiesList.length-1]]=value)}function openJobInSchedulerPortal(jobId){if(jobId){var url=JSON.parse(localStorage.schedulerPortalUrl)+"/?job="+jobId,win=$window.open(url,"/scheduler/");win.focus()}}function openJobInfoPopup(jobId){window.open("#/job-info?jobid="+jobId+"&tab=0","job-info-"+jobId,"toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,directories=no,status=no")}function updateCursor(isWaiting){var body=angular.element(document).find("body");isWaiting?body.addClass("waiting"):body.removeClass("waiting")}function isSpecialUIModel(variable){return-1!==specialUIModel.findIndex(function(targetModel){return variable.resolvedModel?0==variable.resolvedModel.toLowerCase().indexOf(targetModel):!1})}function isTextAreaModel(variable){return-1!==textAreaModel.findIndex(function(targetModel){return variable.resolvedModel?0==variable.resolvedModel.toLowerCase().indexOf(targetModel):!0})}function getWorkflowMetadata(workflow,label,key){var obj=workflow.object_key_values.find(function(okv){return okv.label===label&&okv.key===key});return obj&&obj.value}function isVariablesIncludeAdvancedVar(variables){return variables.findIndex(function(variable){return variable.advanced})>-1}function extractVariableValue(variable,model){return model&&0==model.toLowerCase().indexOf("pa:boolean")?"true"===variable.value.toLowerCase()||1==variable.value?"true":"false"===variable.value.toLowerCase()||0==variable.value?"false":void 0:variable.value}function extractVariables(modifiedWorkflow){var variables=[];return angular.forEach(modifiedWorkflow.variables_order,function(group,key){angular.forEach(group,function(variable){variable.value=extractVariableValue(variable,variable.model),variable.group=key,variables.push(variable)})}),variables}function openCatalogObjectModal(variable,variableModel){$uibModal.open({templateUrl:"views/modals/catalog_objects_modal.html",controller:"CatalogObjectsModalCtrl",windowClass:"fadeIn catalog-objects-modal",size:"xl",keyboard:!0,backdrop:"static",resolve:{variable:function(){return variable},variableModel:function(){return variableModel}}})}function openFileBrowser(variable,dataspace,selectFolder,allowToEdit){$uibModal.open({templateUrl:"views/modals/dataspace-file-browser.html",controller:"FileBrowserModalCtrl",windowClass:"fadeIn file-browser-modal",size:"xl",keyboard:!0,backdrop:"static",resolve:{dataspace:function(){return dataspace},variable:function(){return variable},selectFolder:function(){return selectFolder},allowToEdit:function(){return void 0===allowToEdit?!0:allowToEdit}}})}function openThirdPartyCredentialsModal(credKey){$uibModal.open({templateUrl:"views/modals/third_party_credentials.html",controller:"ThirdPartyCredentialModalCtrl",windowClass:"fadeIn",keyboard:!0,backdrop:"static",size:"lg",resolve:{credKey:function(){return credKey}}})}function uploadDataspaceFile(url,selectedFile,isGlobalFile,successCallback,errorCallback){void 0===$rootScope.uploadingFiles&&($rootScope.uploadingFiles=[]),void 0===$rootScope.uploadingCancelers&&($rootScope.uploadingCancelers=new Map);var uploadId=Math.random().toString(36).substr(2,9);$rootScope.uploadingFiles.push({id:uploadId,filename:selectedFile.name,size:toReadableFileSize(selectedFile.size),isGlobalFile:isGlobalFile,uploaded:0,remainingSeconds:0});var uploadRequestCanceler=$q.defer();$rootScope.uploadingCancelers.set(uploadId,{filename:selectedFile.name,canceler:uploadRequestCanceler});var timeStarted=moment();$http({url:url,method:"PUT",data:selectedFile,processData:!1,timeout:uploadRequestCanceler.promise,uploadEventHandlers:{progress:function(e){if(e.lengthComputable){uploadProgress=e.loaded/e.total*100,$("."+uploadId+" .progress-bar").css("width",uploadProgress+"%"),$("."+uploadId+" .upload-progress").html(toReadableFileSize(e.loaded)+"/"+toReadableFileSize(e.total));var timeElapsed=moment().diff(timeStarted),uploadSpeed=e.loaded/(timeElapsed/1e3);$("."+uploadId+" .upload-speed").html(toReadableNetworkSpeed(8*uploadSpeed));var remainingSeconds=Math.floor((e.total-e.loaded)/uploadSpeed);$("."+uploadId+" .upload-remaining-time").html(timeToHHMMSS(remainingSeconds)+" left");for(var maxRemainSeconds=0,totalUploaded=0,totalSize=0,i=0;i<$rootScope.uploadingFiles.length;i++)$rootScope.uploadingFiles[i].id===uploadId&&($rootScope.uploadingFiles[i].uploaded=e.loaded,$rootScope.uploadingFiles[i].remainingSeconds=remainingSeconds),maxRemainSeconds=Math.max(maxRemainSeconds,$rootScope.uploadingFiles[i].remainingSeconds),totalUploaded+=$rootScope.uploadingFiles[i].uploaded,totalSize+=$rootScope.uploadingFiles[i].size;$rootScope.totalRemainTime=1e3*maxRemainSeconds,$rootScope.totalProgress=totalUploaded/totalSize*100}}},headers:{sessionid:getSessionId()}}).success(function(data){successCallback(),toaster.success("Your file "+selectedFile.name+" has been successfully uploaded."),$rootScope.uploadingFiles=$rootScope.uploadingFiles.filter(function(x){return x.id!==uploadId}),$rootScope.uploadingCancelers["delete"](uploadId)}).error(function(xhr,status,headers,config){if(errorCallback(),499!==config.timeout.status){var errorMessage="";xhr&&(errorMessage=": "+xhr),toaster.error("Failed to upload the file "+selectedFile.name+errorMessage)}$rootScope.uploadingFiles=$rootScope.uploadingFiles.filter(function(x){return x.id!==uploadId}),$rootScope.uploadingCancelers["delete"](uploadId)})}function timeToHHMMSS(totalSeconds){return totalSeconds?moment.duration(1e3*totalSeconds).format("D[d]H[h]m[m]s[s]"):""}function toReadableNetworkSpeed(uploadSpeedBps){var uploadSpeedKbps=uploadSpeedBps/1024;return 1>uploadSpeedKbps?uploadSpeedBps.toFixed(2)+" b/s":1024>uploadSpeedKbps?uploadSpeedKbps.toFixed(2)+" Kb/s":(uploadSpeedKbps/1024).toFixed(2)+" Mb/s"}function toReadableFileSize(size){"number"!=typeof bytes&&(size=parseInt(size));for(var units=[" B"," KB"," MB"," GB"," TB"],unitIndex=0;size>=1024&&unitIndex<units.length-1;)size/=1024,unitIndex++;return size.toFixed(1)+units[unitIndex]}function translate(stringsToTranslate){var translatedStr="";if(void 0!==stringsToTranslate)for(Array.isArray(stringsToTranslate)||(stringsToTranslate=[stringsToTranslate]),i=0;i<stringsToTranslate.length;i++)translatedStr=translatedStr.concat(" ").concat($filter("translate")(stringsToTranslate[i].replace(/\n/gm,"<br>")));return translatedStr.trim()}function displayTranslatedMessage(type,titleToTranslate,messageToTranslate,callback){var swalContent={html:!0,customClass:"swal-style"};void 0!==titleToTranslate&&(Array.isArray(titleToTranslate)||(titleToTranslate=[titleToTranslate]),swalContent.title=translate(titleToTranslate)),void 0!==messageToTranslate&&(Array.isArray(messageToTranslate)||(messageToTranslate=[messageToTranslate]),swalContent.text=translate(messageToTranslate)),"error"===type||"warning"===type||"success"===type||"info"===type?swalContent.type=type:void 0===type?console.log("No type has been defined for the displayed message"):console.log(type+" is not a valid message type to be displayed"),SweetAlert.swal(swalContent,callback)}function displayTranslatedErrorMessage(title,message){displayTranslatedMessage("error",title,message)}function displayTranslatedSuccessMessage(title,message,callback){displayTranslatedMessage("success",title,message,callback)}function openEndpoint(url){url.match(/^[a-zA-Z]+:\/\//)||(url=window.location.protocol+"//"+url);var parsedUrl=new URL(url);parsedUrl.protocol.startsWith("http")&&(parsedUrl.pathname.includes("cloud-automation-service/services/")&&(parsedUrl.hostname=window.location.hostname,$cookies.put("sessionid",getSessionId(),{domain:parsedUrl.hostname,path:"/"})),$window.open(parsedUrl.href,url))}function getByKey(propertyLabel,propertyName,collection){for(var len=collection.length,value="",i=0;len>i;i++)collection[i].label===propertyLabel&&collection[i].key.toLowerCase()===propertyName.toLowerCase()&&(value=collection[i].value);return value}function getEndpointUrl(endpoint){return endpoint.proxyfied?endpoint.proxyfiedUrl:endpoint.url}function getVariablesInKeyValueFormat(variables){var result={};return angular.forEach(variables,function(variable){var name=variable.name,value=variable.value;result[name]=value}),result}function modelToDateFormat(model){var indexBegin=model.indexOf("("),indexEnd=model.lastIndexOf(")"),javaDateTimeFormat=model.substring(indexBegin+1,indexEnd).trim();return moment().toMomentFormatString(javaDateTimeFormat)}function modelToList(model){var indexBegin=model.indexOf("("),indexEnd=model.lastIndexOf(")"),options=model.substring(indexBegin+1,indexEnd).split(",");return options.map(function(option){return option.trim()})}function modelToDateScope(model){var indexBegin=model.indexOf("["),indexEnd=model.lastIndexOf("]"),dates=model.substring(indexBegin+1,indexEnd).split(","),dateScope={};return dates.length>1&&(dateScope.min=dates[0].trim(),dateScope.max=dates[1].trim()),dateScope}function createPathStringFromMap(map,valuePropertyName){var result="";return map.forEach(function(item){result+=item.name+"="+encodeURIComponent(valuePropertyName?item[valuePropertyName]:item)+";"}),result.substring(0,result.length-1)}function parseEmptyVariablesValue(variables){return angular.forEach(variables,function(variable){null==variable.value&&(variable.value="")}),variables}function replaceModelWithFetched(model){var indexBegin=model.indexOf("("),indexEnd=model.lastIndexOf(")"),urlToFetch=model.substring(indexBegin+1,indexEnd),origin=$window.location.origin;return origin.endsWith("/")||(origin+="/"),urlToFetch=urlToFetch.replace(/(\$\{PA_CATALOG_REST_URL\}|\$PA_CATALOG_REST_URL)/g,origin+"catalog"),urlToFetch=urlToFetch.replace(/(\$\{PA_SCHEDULER_REST_URL\}|\$PA_SCHEDULER_REST_URL)/g,origin+"rest"),urlToFetch=urlToFetch.replace(/(\$\{PA_SCHEDULER_REST_PUBLIC_URL\}|\$PA_SCHEDULER_REST_PUBLIC_URL)/g,origin+"rest"),urlToFetch=urlToFetch.replace(/(\$\{PA_CATALOG_REST_PUBLIC_URL\}|\$PA_CATALOG_REST_PUBLIC_URL)/g,origin+"catalog"),getStringByUrl(urlToFetch)}function replaceVariableModelsIfNeeded(variables){if(Array.isArray(variables))variables.filter(function(variable){return variable.resolvedModel&&-1!==variable.resolvedModel.toLowerCase().indexOf("pa:model_from_url")}).map(function(variable){variable.resolvedModel=replaceModelWithFetched(variable.resolvedModel),0!=variable.resolvedModel.toLowerCase().indexOf("pa:list")||variable.value||(variable.value=modelToList(variable.resolvedModel)[0])});else for(var prop in variables){var variable=variables[prop];variable.resolvedModel&&-1!==variable.resolvedModel.toLowerCase().indexOf("pa:model_from_url")&&(variable.resolvedModel=replaceModelWithFetched(variable.resolvedModel)),0!=variable.resolvedModel.toLowerCase().indexOf("pa:list")||variable.value||(variable.value=modelToList(variable.resolvedModel)[0])}}function getStringByUrl(url){var request=new XMLHttpRequest;return request.open("GET",url,!1),request.send(),request.responseText}function validateWorkflow(bucketName,workflowName,variables){const configHeaders={headers:{link:catalogUrlPrefix+bucketName+"/resources/"+encodeURIComponent(workflowName)+"/raw",sessionid:getSessionId(),"Content-Type":"application/json"}};createPathStringFromMap(parseEmptyVariablesValue(variables),"value");var variablesMap=variables.reduce(function(map,obj){return map[obj.name]=obj.value,map},{}),data=JSON.stringify(variablesMap);return $http.post(schedulerRestUrl()+"validateurl/body",data,configHeaders)}function submitJob(bucketName,workflowName,variables,submissionMode){const configHeaders={headers:{link:catalogUrlPrefix+bucketName+"/resources/"+encodeURIComponent(workflowName)+"/raw",sessionid:getSessionId(),"Content-Type":"application/json"}};var variablesMap=variables.reduce(function(map,obj){return map[obj.name]=obj.value,map},{}),data=JSON.stringify(variablesMap);return $http.post(schedulerRestUrl()+"jobs/body?submission.mode="+submissionMode,data,configHeaders)}function getJobInfoForJob(jobId){return getSessionId()?$http.get(schedulerRestUrl()+"jobs/"+jobId+"/info",{headers:{sessionid:getSessionId()}}):void 0}function getThirdPartyCredentials(){return $http.get(schedulerRestUrl()+"credentials/",{headers:{sessionid:getSessionId()}})}function postThirdPartyCredentials(key,value){const configHeaders={headers:{sessionid:getSessionId(),"Content-Type":"application/x-www-form-urlencoded"}};return $http.post(schedulerRestUrl()+"credentials/"+encodeURIComponent(key),$httpParamSerializerJQLike({value:value}),configHeaders)}function removeThirdPartyCredentials(key){return $http["delete"](schedulerRestUrl()+"credentials/"+encodeURIComponent(key),{headers:{sessionID:getSessionId()}})}const specialUIModel=["pa:boolean","pa:list","pa:datetime","pa:hidden","pa:global_file","pa:user_file","pa:global_folder","pa:user_folder","pa:catalog_object","pa:credential"],textAreaModel=["pa:regexp","pa:spel","pa:json","pa:not_empty_string"],catalogUrlPrefix=$location.$$protocol+"://"+$location.$$host+":"+$location.port()+"/catalog/buckets/",defaultUserPreferences={submissionView:{selectedBucketName:"",showPSAWorkflowsOnly:!1,toggleListBox:{value:!1},orderByColumnConfig:{workflows:{column:"",comparatorLogic:"",order:""},buckets:{column:"name",comparatorLogic:"+name",order:"d"}}}},orderVariables=function(modifiedVariables){var variables=[];return angular.forEach(modifiedVariables,function(variable){variable.value=extractVariableValue(variable,variable.model),variable.group||variables.push(variable)}),angular.forEach(modifiedVariables,function(variable){variable.group&&variables.push(variable)}),variables};return{openJobInSchedulerPortal:openJobInSchedulerPortal,openJobInfoPopup:openJobInfoPopup,isSpecialUIModel:isSpecialUIModel,isTextAreaModel:isTextAreaModel,getSortClasses:getSortClasses,openCatalogObjectModal:openCatalogObjectModal,openFileBrowser:openFileBrowser,openThirdPartyCredentialsModal:openThirdPartyCredentialsModal,uploadDataspaceFile:uploadDataspaceFile,toReadableFileSize:toReadableFileSize,translate:translate,displayTranslatedMessage:displayTranslatedMessage,displayTranslatedErrorMessage:displayTranslatedErrorMessage,displayTranslatedSuccessMessage:displayTranslatedSuccessMessage,updateCursor:updateCursor,extractVariables:extractVariables,orderVariables:orderVariables,openEndpoint:openEndpoint,getEndpointUrl:getEndpointUrl,getByKey:getByKey,getVariablesInKeyValueFormat:getVariablesInKeyValueFormat,isVariablesIncludeAdvancedVar:isVariablesIncludeAdvancedVar,modelToDateFormat:modelToDateFormat,modelToList:modelToList,modelToDateScope:modelToDateScope,loadUserPreferences:loadUserPreferences,getUserPreference:getUserPreference,setUserPreference:setUserPreference,getWorkflowMetadata:getWorkflowMetadata,replaceVariableModelsIfNeeded:replaceVariableModelsIfNeeded,parseEmptyVariablesValue:parseEmptyVariablesValue,createPathStringFromMap:createPathStringFromMap,validateWorkflow:validateWorkflow,submitJob:submitJob,getJobInfoForJob:getJobInfoForJob,getThirdPartyCredentials:getThirdPartyCredentials,postThirdPartyCredentials:postThirdPartyCredentials,removeThirdPartyCredentials:removeThirdPartyCredentials}}function searchHighlight($sce){return function(text,phrase,useRegExp){if(phrase&&text)if(useRegExp)try{text=text.replace(new RegExp("("+phrase+")","gi"),'<span class="highlighted">$1</span>')}catch(regexException){}else text=text.replace(phrase,'<span class="highlighted">'+phrase+"</span>");return $sce.trustAsHtml(text)}}function dateTimeFormat(){return function(input){return input=input||"",moment(input).format("L HH:mm:ss")}}function escapeQuotes(){return function(input){return null===input?input:input.replace(/["']/g,"&lsquo;")}}function isDigit(){return function(input){return input.match(/^\d/)}}function getFirstLetter(){return function(input){return Array.from(input)[0]}}function durationFormatWE(){return function(input){var formatString="D[d]H[h]m[m]s[s]SSS[ms]";return input>864e5?formatString="D[d]H[h]":input>36e5?formatString="D[d]H[h]m[m]":input>6e4&&(formatString="D[d]H[h]m[m]s[s]"),input?moment.duration(input).format(formatString):""}}function WorkflowVisualizationController($scope,$timeout){function centerVisualization(){var visuElement=angular.element(document.querySelector(".workflow-visualization-modal #workflow-visualization"))[0],visuContainerElement=angular.element(document.querySelector(".workflow-visualization-modal #workflow-visualization-view"))[0];if(visuElement&&visuContainerElement){var visuContainerWidth=visuContainerElement.offsetWidth,visuContainerHeight=visuContainerElement.offsetHeight,visuSize=getVisuSize(".workflow-visualization-modal #workflow-visualization-view"),translateX=Math.max(.5*visuContainerWidth-.5*visuSize.width,0),translateY=Math.max(.5*visuContainerHeight-.5*visuSize.height,0);visuElement.style.transform="translate("+translateX+"px,"+translateY+"px)"}}this.$onInit=function(){scaleVisu(),$scope.$on("event:scaleVisu",function(){scaleVisu()}),$scope.$on("event:centerVisu",function(){centerVisualization()})};var scaleVisu=function(){$timeout(function(){var visuElement=angular.element(document.querySelector("#object-details-panel #workflow-visualization"))[0],visuContainerElement=angular.element(document.querySelector("#object-details-panel #workflow-visualization-view"))[0];if(visuElement&&visuContainerElement){var visuContainerWidth=visuContainerElement.offsetWidth,visuContainerHeight=visuContainerElement.offsetHeight,visuSize=getVisuSize("#object-details-panel #workflow-visualization-view"),scaleValue=Math.min(visuContainerWidth/visuSize.width,visuContainerHeight/visuSize.height);scaleValue>1&&(scaleValue=1);var newHeightValue=scaleValue*visuSize.height+50,originalTop=parseInt($("#object-details-panel #workflow-visualization").css("top"),10),originalLeft=parseInt($("#object-details-panel #workflow-visualization").css("left"),10),newTop=originalTop*scaleValue,newLeft=originalLeft*scaleValue,translateX=.5*visuContainerWidth-visuSize.width*scaleValue*.5;visuElement.style.transform="scale("+scaleValue+") translate("+translateX+"px, 0px)",visuElement.style["transform-origin"]="0 0",visuElement.style.top=newTop+"px",visuElement.style.left=newLeft+"px",visuContainerElement.style.height=newHeightValue+"px"}})},getVisuSize=function(visuSelector){var visuSize={height:200,width:200},maxTop=0,maxLeft=0,minTop=1/0,minLeft=1/0,maxTaskWidth=0,maxTaskHeight=0,additionalSpace=50;return $(visuSelector).find(".task").each(function(){var taskTop=parseInt($(this).css("top"),10),taskLeft=parseInt($(this).css("left"),10);minLeft>taskLeft&&(minLeft=taskLeft),taskLeft>maxLeft&&(maxLeft=taskLeft),minTop>taskTop&&(minTop=taskTop),taskTop>maxTop&&(maxTop=taskTop);var taskWidth=$(this).outerWidth(),taskHeight=$(this).outerHeight();taskWidth>maxTaskWidth&&(maxTaskWidth=taskWidth),taskHeight>maxTaskHeight&&(maxTaskHeight=taskHeight)}),maxTaskHeight+=additionalSpace,maxTaskWidth+=additionalSpace,minTop!==maxTop?visuSize.height=maxTop-minTop+maxTaskHeight:visuSize.height=maxTaskHeight,minLeft!==maxLeft?visuSize.width=maxLeft-minLeft+maxTaskWidth:visuSize.width=maxTaskWidth,visuSize}}function config($stateProvider,$urlRouterProvider){$stateProvider.state("login",{url:"/login",templateUrl:"views/login.html",authenticate:!1,params:{redirectsTo:""}}).state("portal",{"abstract":!0,url:"/portal",templateUrl:"views/common/content.html",authenticate:!0}).state("job-info",{url:"/job-info?jobid&tab",data:{pageTitle:"Job details"},templateUrl:"views/workflow-execution/workflow-execution/templates/job-details-container.html",css:"styles/workflow-execution/workflow_execution_custom_style.css",authenticate:!0}).state("portal.subview1",{url:"/workflow-execution",data:{pageTitle:"Workflow Execution"},templateUrl:"views/workflow-execution/workflow-execution/workflow_execution.html",css:"styles/workflow-execution/workflow_execution_custom_style.css",authenticate:!0}).state("portal.subview2",{url:"/catalog-portal",data:{pageTitle:"Catalog"},templateUrl:"views/catalog-portal/generic_catalog.html",css:"styles/catalog-portal/gcportal_custom_style.css",authenticate:!0}).state("portal.subview3",{url:"/health-dashboard",data:{pageTitle:"Health Dashboard"},templateUrl:"views/health-dashboard/health-dashboard/health-dashboard.html",css:"styles/health-dashboard/heath_dashboard_custom_style.css",authenticate:!0}).state("portal.subview4",{url:"/job-analytics",data:{pageTitle:"Job Analytics"},templateUrl:"views/job-analytics/job_analytics.html",css:"styles/job-analytics/job_analytics_custom_style.css",authenticate:!0}).state("portal.subview5",{url:"/job-gantt",data:{pageTitle:"Job Gantt"},templateUrl:"views/job-gantt/job-gantt/job_gantt.html",css:"styles/job-gantt/job_analytics_custom_style.css",authenticate:!0}).state("portal.subview6",{url:"/node-gantt",data:{pageTitle:"Node Gantt"},templateUrl:"views/node-gantt/node-gantt/node_gantt.html",css:"styles/node-gantt/node_gantt_custom_style.css",authenticate:!0}).state("portal.subview7",{url:"/job-planner-calendar-def",data:{pageTitle:"Calendar Definition"},templateUrl:"views/job-planner-calendar-def/execution_calendars.html",css:"styles/job-planner-calendar-def/portal_custom_style.css",authenticate:!0}).state("portal.subview8",{url:"/job-planner-calendar-def-workflows",data:{pageTitle:"Calendar Associations"},templateUrl:"views/job-planner-calendar-def-workflows/calendar-association/calendar_association.html",css:"styles/job-planner-calendar-def-workflows/portal_custom_style.css",authenticate:!0}).state("portal.subview9",{url:"/job-planner-execution-planning",data:{pageTitle:"Execution Planning"},templateUrl:"views/job-planner-execution-planning/execution_planning.html",css:"styles/job-planner-execution-planning/portal_custom_style.css",authenticate:!0}).state("portal.subview10",{url:"/job-planner-gantt-chart",data:{pageTitle:"Gantt Chart"},templateUrl:"views/job-planner-gantt-chart/gantt-chart/gantt_view_main.html",css:"styles/job-planner-gantt-chart/portal_custom_style.css",authenticate:!0}).state("portal.subview11",{url:"/event-orchestration",data:{pageTitle:"Event Orchestration"},templateUrl:"views/event-orchestration/cloud_watch.html",css:"styles/event-orchestration/cloud_watch_custom_style.css",authenticate:!0}).state("portal.subview12",{url:"/service-automation",data:{pageTitle:"Service Automation"},templateUrl:"views/service-automation/cloud-automation/cloud_automation.html",css:"styles/service-automation/portal_custom_style.css",authenticate:!0}).state("portal.subview13",{url:"/notification-portal",data:{pageTitle:"Notifications"},templateUrl:"views/notification-portal/notification-portal.html",css:"styles/notification-portal/notifportal_custom_style.css",authenticate:!0})}function pageTitle($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState){var title="ProActive Automation Dashboard";toState.data&&toState.data.pageTitle&&(title+=" | "+toState.data.pageTitle),$timeout(function(){element.text(title)})};$rootScope.$on("$stateChangeStart",listener)}}}function sideNavigation($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.metisMenu()})}}}function iboxTools($timeout){return{restrict:"A",scope:!0,templateUrl:"views/common/ibox_tools.html",controller:function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first"),content=ibox.find("div.ibox-content");content.slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){var ibox=$element.closest("div.ibox");ibox.remove()}}}}function minimalizaSidebar($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary" style="color: #002d66" href="" ng-click="minimalize()" ><i class="fa fa-bars" style="color: #002d66"></i></a>',controller:function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},200)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},100)):$("#side-menu").removeAttr("style")}}}}function iboxToolsFullScreen($timeout){return{restrict:"A",scope:!0,templateUrl:"views/common/ibox_tools_full_screen.html",controller:function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first"),content=ibox.find("div.ibox-content");content.slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){var ibox=$element.closest("div.ibox");ibox.remove()},$scope.fullscreen=function(){var ibox=$element.closest("div.ibox"),button=$element.find("i.fa-expand");$("body").toggleClass("fullscreen-ibox-mode"),button.toggleClass("fa-expand").toggleClass("fa-compress"),ibox.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}}}}function icheck($timeout){return{restrict:"A",require:"ngModel",link:function($scope,element,$attrs,ngModel){return $timeout(function(){var value;return value=$attrs.value,$scope.$watch($attrs.ngModel,function(newValue){$(element).iCheck("update")}),$(element).iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green"}).on("ifChanged",function(event){return"checkbox"===$(element).attr("type")&&$attrs.ngModel&&$scope.$apply(function(){return ngModel.$setViewValue(event.target.checked)}),"radio"===$(element).attr("type")&&$attrs.ngModel?$scope.$apply(function(){return ngModel.$setViewValue(value)}):void 0})})}}}function slimScroll($timeout){return{restrict:"A",scope:{boxHeight:"@"},link:function(scope,element){$timeout(function(){element.slimscroll({height:scope.boxHeight,railOpacity:.9})})}}}function backToTop(){return{restrict:"E",transclude:!0,replace:!0,template:'<div id="backtop"><button><div ng-transclude></div></button></div>',scope:{text:"@buttonText",speed:"@scrollSpeed"},link:function(scope,element){scope.text=scope.text||"Scroll top",scope.speed=parseInt(scope.speed,10)||300;var speed=Math.round(scope.speed/100),onscroll=function(){window.pageYOffset>0?element.showing||(element.addClass("show"),
element.showing=!0):(element.removeClass("show"),element.showing=!1)};scope.currentYPosition=function(){return document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0},element.showing=!1,element.on("click",function(){window.removeEventListener("scroll",onscroll),element.removeClass("show"),element.showing=!1;var startY=scope.currentYPosition(),step=Math.round(startY/25),leapY=100>startY?0:startY-step,scrollInterval=setInterval(function(){window.scrollTo(0,leapY),leapY||(clearInterval(scrollInterval),window.addEventListener("scroll",onscroll)),leapY-=step,0>leapY&&(leapY=0)},speed)}),window.addEventListener("scroll",onscroll),scope.$on("$destroy",function(){window.removeEventListener("scroll",onscroll)})}}}function showDropdownFromTemplate($document,$timeout,$uibPosition){function link(scope,element){element.bind("click",onClick)}function waitForElement(selector,callback){angular.element(selector).length?callback():$timeout(function(){waitForElement(selector,callback)},100)}function onClick(e){waitForElement("body.uib-dropdown-open",function(){var element=angular.element(e.currentTarget);jQuery(element).siblings("ul.dropdown-menu").length||waitForElement(".dropdown-menu.custom-dropdown",function(){var css,rightAlign,scrollbarPadding,ul=angular.element(".dropdown-menu.custom-dropdown"),pos=$uibPosition.positionElements(element,ul,"bottom-left",!0),scrollbarWidth=0;css={top:pos.top+"px",display:"block"},rightAlign=ul.hasClass("dropdown-menu-right"),rightAlign?(css.left="auto",scrollbarPadding=$uibPosition.scrollbarPadding(angular.element("body")),scrollbarPadding.heightOverflow&&scrollbarPadding.scrollbarWidth&&(scrollbarWidth=scrollbarPadding.scrollbarWidth),css.right=window.innerWidth-scrollbarWidth-(pos.left+element.prop("offsetWidth"))+"px"):(css.left=pos.left+"px",css.right="auto"),ul.css(css)})})}return{restrict:"A",scope:{},link:link}}function inputFileChange($parse,$timeout){return{restrict:"A",link:function(scope,element,attrs){var onChangeHandler=$parse(attrs.inputFileChange);element.bind("change",function(){$timeout(function(){onChangeHandler(scope)})})}}}function multiselectShiftKey(){return{restrict:"AE",scope:{selectedItems:"=selectedItems",allItems:"=items"},link:function(scope,element){function moveUp(){const lastSelectIndex=scope.allItems.result.findIndex(function(association){return association.id===scope.selectedItems[scope.selectedItems.length-1].id});var index=scope.selectedItems.findIndex(function(item,index){return index>0&&item.id===scope.allItems.result[lastSelectIndex-1].id});index>=0&&scope.selectedItems.splice(index,1);var nextWorkflow;lastSelectIndex?nextWorkflow=scope.allItems.result[lastSelectIndex-1]:0===lastSelectIndex&&(nextWorkflow=scope.allItems.result[scope.allItems.result.length-1]),scope.$apply(function(){scope.selectedItems.push(nextWorkflow)})}function moveDown(){const lastSelectIndex=scope.allItems.result.findIndex(function(association){return association.id===scope.selectedItems[scope.selectedItems.length-1].id});var index=scope.selectedItems.findIndex(function(item){return item.id===scope.allItems.result[lastSelectIndex+1].id});index>=0&&scope.selectedItems.splice(index,1),lastSelectIndex!==scope.allItems.result.length-1&&scope.$apply(function(){scope.selectedItems.push(scope.allItems.result[lastSelectIndex+1])})}const shiftKey=16,upKey=38,downKey=40;var ctrlDown=!1;element.keydown(function(event){event.keyCode==shiftKey&&(ctrlDown=!0)}).keyup(function(event){event.keyCode==shiftKey&&(ctrlDown=!1)}),element.keydown(function(event){(!scope.allItems.result||Array.isArray(scope.allItems.result))&&(ctrlDown&&event.keyCode==upKey&&scope.selectedItems&&scope.selectedItems.length?moveUp():ctrlDown&&event.keyCode==downKey&&scope.selectedItems&&scope.selectedItems.length&&moveDown())}),scope.$on("$destroy",function(){element.off("keydown")})}}}function copyClipBoard(){function link(scope,element,attrs){element.bind("click",function(){var copyInput=document.getElementById("direct-object-url-input");copyInput.select(),document.execCommand("copy")})}return{restrict:"A",link:link}}function ellipsisTooltip(){return{restrict:"A",link:function(scope,element,attrs){const el=element[0],ttDisableAttr="tooltipEnable",ttEventTrigger="mouseenter",ttShowEventBind=function(event,isTriggeredByItself){el.offsetHeight<el.scrollHeight&&(attrs.$set(ttDisableAttr,"true"),isTriggeredByItself||element.triggerHandler(ttEventTrigger,[!0]),scope.$applyAsync(function(){attrs.$set(ttDisableAttr,"false")}))};angular.isObject(el)&&(attrs.$set(ttDisableAttr,"false"),element.on(ttEventTrigger,ttShowEventBind),element.on("$destroy",function(){element.off(ttEventTrigger,ttShowEventBind)}))}}}function uiSelectDirective($timeout){return{restrict:"E",scope:!1,link:function(scope,element,attrs){$timeout(function(){const selectElement=element[0].querySelector(".ui-select-container"),uiSelect=angular.element(selectElement).controller("uiSelect");$timeout(function(){uiSelect.open=!0,uiSelect.activate(!1,!0)})})}}}function MainCtrl(){this.userName=localStorage["pa.login"]}$(document).ready(function(){$(window).scroll(function(){$(window).scrollTop()>0&&!$("body").hasClass("fixed-nav")?$("#right-sidebar").addClass("sidebar-top"):$("#right-sidebar").removeClass("sidebar-top")})}),$(function(){$(window).bind("load resize",function(){$(document).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")})});var mainModule=angular.module("main",["ngResource","spring-data-rest","angular-toArrayFilter","oitozero.ngSweetAlert","ngSanitize","pascalprecht.translate","ui.grid","ui.grid.resizeColumns","ui.grid.selection","ui.grid.exporter","ui.grid.moveColumns","ui.grid.pinning","toaster","ui.grid.autoResize"]),isSessionValide=function($http,sessionId,$location){return getProperties($http,$location).then(function(){var rmRestUrl=localStorage.rmRestUrl,userDataUrl=JSON.parse(rmRestUrl)+"logins/sessionid/"+sessionId+"/userdata/";return $http.get(userDataUrl).then(function(result){return""!==result.data})})};mainModule.factory("loadingConfigData",function($http,$location){return getProperties($http,$location),{doNothing:function(){return null}}}),mainModule.factory("permissionService",function($http,$interval,$rootScope,$state){function doLogin(userName,userPass){var authData=$.param({username:userName,password:userPass}),authConfig={headers:{"Content-Type":"application/x-www-form-urlencoded"},transformResponse:[]};return $http.post(JSON.parse(localStorage.schedulerRestUrl)+"login",authData,authConfig).success(function(response){response.match(/^[A-Za-z0-9]+$/)?localStorage["pa.session"]=response:console.error("doLogin authentication has failed:",response)}).error(function(response){console.error("doLogin authentication error:",status,response)})}function getPortalAccessPermission(portal){var requestGetPortalAccessPermissionUrl=JSON.parse(localStorage.restUrl)+"/common/permissions/portals/"+portal,config={headers:{sessionid:getSessionId(),"Content-Type":"application/json"}};return $http.get(requestGetPortalAccessPermissionUrl,config)}function getPortalsAccessPermission(portals){var requestGetPortalsAccessPermissionUrl=JSON.parse(localStorage.restUrl)+"/common/permissions/portals?"+expandListParam("portals",portals).concat("&"),config={headers:{sessionid:getSessionId(),"Content-Type":"application/json"}};return $http.get(decodeURIComponent(requestGetPortalsAccessPermissionUrl.slice(0,-1)),config)}function expandListParam(queryParam,listParam){return listParam.map(function(item){return queryParam+"="+item}).join("&")}return{doLogin:function(userName,userPass){return doLogin(userName,userPass)},getPortalAccessPermission:function(portal){return getPortalAccessPermission(portal)},getPortalsAccessPermission:function(portals){return getPortalsAccessPermission(portals)}}}),mainModule.run(["$rootScope",function($rootScope){$rootScope.lang="en"}]),mainModule.config(function($translateProvider,$translatePartialLoaderProvider){$translatePartialLoaderProvider.addPart("resources"),$translateProvider.useLoader("$translatePartialLoader",{urlTemplate:"{part}/locales/locale-{lang}.json"}).preferredLanguage(localStorage.proactiveLanguage),$translateProvider.useSanitizeValueStrategy("escapeParameters")}),mainModule.controller("mainController",function($window,$http,$scope,$rootScope,$state,$location,$interval,$translate,$timeout,$uibModalStack,permissionService,SweetAlert,UtilsFactory){function checkSession(){var sessionId=getSessionId();sessionId?$http.get(JSON.parse(localStorage.schedulerRestUrl)+"isconnected/",{headers:{sessionID:sessionId}}).then(function(response){if(response){if($rootScope.isLoggedOut=!1,$("#login-view").is(":visible")&&!$scope.firstAccessiblePortal){$scope.main.userName=localStorage["pa.login"];var sessionid=getSessionId();sessionid&&$scope.determineFirstAuthorizedPortalAndAllPortalsAccessPermission($scope.redirectsTo),$rootScope.serverIsDown=!1}}else $scope.closeSession()})["catch"](function(response){console.error("Error checking if session is valid:",response),$rootScope.isLoggedOut=!0}):($uibModalStack.dismissAll(),$(".modal-backdrop").hide(),$scope.closeSession())}function displayAlertAndRedirectToFirstAccessiblePortalIfExist(portal){UtilsFactory.displayTranslatedMessage("warning","Access not authorized",["Cannot connect to",portal+".","The access is not authorized"]),$scope.firstAccessiblePortal?$state.go($scope.automationDashboardPortals[$scope.firstAccessiblePortal]):($rootScope.errorMessage="The user "+localStorage["pa.login"]+" is not allowed to access to the Automation Dashboard Portal",$state.go("login"),console.error("The user "+localStorage["pa.login"]+" is not allowed to access to the Automation Dashboard Portal",response))}function waitAndApplyWEJobRowContextMenuDisplay(data){if($("#context-menu").length)return!0;var observer=new MutationObserver(function(mutations){var contextMenuIncludeElement=angular.element("#context-menu")[0].children[0].children[0];mutations.length&&contextMenuIncludeElement&&(angular.element(contextMenuIncludeElement.childNodes[0]).removeClass("dropdown-menu"),closeJobRowOtherActionsDropDown(),observer.disconnect())});return observer.observe($("#workflow-execution-main")[0],{childList:!0,subtree:!0}),!1}function injectDataInContextMenuScope(data){Object.keys(data).forEach(function(key){angular.element(document.getElementById("context-menu")).scope()[key]=data[key]})}function closeJobRowOtherActionsDropDown(){var dropdownMenu=angular.element(document.getElementsByClassName("dropdown-menu dropdown-menu-right custom-dropdown ng-scope"));dropdownMenu&&dropdownMenu.toggle()}this.$onInit=function(){if($scope.main.userName=localStorage["pa.login"],$scope.startRegularCheckSession(),$scope.contextDisplay=!1,$scope.contextBucketDisplay=!1,$scope.contextPosition="",$scope.firstAccessiblePortal="",$scope.portalsAccessPermission={},$scope.automationDashboardPortals={},$rootScope.errorMessage=void 0,getSessionId()){var restUrl=angular.toJson($location.$$protocol+"://"+$location.$$host+":"+$location.port()+"/rest");localStorage.restUrl=restUrl,$scope.determineFirstAuthorizedPortalAndAllPortalsAccessPermission($window.location.href)}},$scope.showParentPortal=function(id){return angular.element(document.getElementById(id)).find("li").length},$scope.changeLanguage=function(key){$rootScope.lang=key,$translate.use(key),localStorage.proactiveLanguage=key},$scope.reloadPortal=function(){location.reload()},$scope.selectedLanguage=function(){$("#language-dropdown").find("a").click(function(){var language=$(this).text();localStorage.selectedLanguage=language;var flagObject=$(this).find("img").attr("src"),flag='<img alt="'+language+'" style="height:25px;padding-left: 0px;padding-right: 5px;padding-top: 4px;padding-bottom: 4px;" src="'+flagObject+'"/>';$("#selected").html(flag+language)})},$scope.startRegularCheckSession=function(){$scope.checkSessionInterval||($scope.checkSessionInterval=$scope.$interval(checkSession,15e3))},$scope.checkPortalAccessPermission=function(url){var portal=url.substring(url.lastIndexOf("/")+1,url.lastIndexOf("?")>0?url.lastIndexOf("?"):void 0);getSessionId()?permissionService.getPortalAccessPermission(portal).then(function(response){response.data?$location.path(url):displayAlertAndRedirectToFirstAccessiblePortalIfExist(portal)})["catch"](function(error,status){$scope.closeSession(),console.error("Error while checking portal access permission",status,error)}):$scope.closeSession()},$scope.determineFirstAuthorizedPortalAndAllPortalsAccessPermission=function(url){var portal="";url&&(portal=url.substring(url.lastIndexOf("/")+1,url.lastIndexOf("?")>0?url.lastIndexOf("?"):void 0)),$state.get().forEach(function(item){item.name&&"login"!==item.name&&"portal"!==item.name&&"job-info"!==item.name&&($scope.automationDashboardPortals[item.url.substring(1)]=item.name,$scope.portalsAccessPermission[item.url.substring(1)]=!1)});var portals=Object.keys($scope.automationDashboardPortals).concat(["studio","rm","scheduler"]);permissionService.getPortalsAccessPermission(portals).then(function(response){if(Array.isArray(response.data)&&response.data.length){var doHaveAccessToWA=response.data.indexOf("workflow-execution");$scope.firstAccessiblePortal=-1!==doHaveAccessToWA?response.data[doHaveAccessToWA]:response.data[0],response.data.forEach(function(authorizedPortal){$scope.portalsAccessPermission[authorizedPortal]=!0}),portal?$scope.portalsAccessPermission[portal]?$state.go($scope.automationDashboardPortals[portal]):("job-info"!==portal||-1===doHaveAccessToWA)&&displayAlertAndRedirectToFirstAccessiblePortalIfExist(portal):$state.go($scope.automationDashboardPortals[$scope.firstAccessiblePortal])}else $rootScope.errorMessage="This user is not allowed to access to the Automation Dashboard Portal",$state.go("login"),console.error("This user is not allowed to access to the Automation Dashboard Portal",response.status)})["catch"](function(error){$scope.closeSession(),console.error("Error while checking portals access permission",error)})},$scope.stopRegularCheckSession=function(){$interval.cancel($scope.checkSessionInterval),$scope.checkSessionInterval=void 0},$scope.closeSession=function(){$state.go("login"),$scope.firstAccessiblePortal="",$rootScope.errorMessage=void 0,$scope.portalsAccessPermission={},$rootScope.uploadingCancelers&&($rootScope.uploadingCancelers.forEach(function(upload,uploadId){upload&&upload.canceler&&(upload.canceler.promise.status=499,upload.canceler.resolve())}),$rootScope.uploadingCancelers.clear(),$rootScope.uploadingFiles.length=0),localStorage.removeItem("pa.session"),$rootScope.$broadcast("event:StopRefreshing")},$scope.disconnect=function(){var disconnectUrlPrefix=JSON.parse(localStorage.schedulerRestUrl)+"disconnect";$http.put(disconnectUrlPrefix,null,{headers:{sessionid:getSessionId()}}).then(function(response){})["catch"](function(response){console.error("Error while disconnecting:",response)})},$scope.displayContextualMenu=function(clickEvent,position,isWEJobRowContextMenu,data){clickEvent.stopPropagation(),$scope.contextPosition=position,$scope.contextDisplay=!0;var isNeedToInjectDataInContextMenuScope=!1;isWEJobRowContextMenu&&(isNeedToInjectDataInContextMenuScope=waitAndApplyWEJobRowContextMenuDisplay(data)),data&&isNeedToInjectDataInContextMenuScope&&injectDataInContextMenuScope(data)},$scope.displayContextualMenuOnBucket=function(clickEvent,position){$scope.contextBucketDisplay=!0,$scope.contextDisplay=!1},$scope.displayContextualMenuOnNodeName=function(){$scope.contextNodeNameDisplay=!0,$scope.contextDisplay=!1},$scope.hideContextualMenu=function(event){event&&($scope.contextDisplay=!1,$scope.contextBucketDisplay=!1,$scope.contextNodeNameDisplay=!1)},$scope.isContextView=function(position){return $scope.contextPosition===position},$scope.moveContextualMenu=function(clickEvent){function callBack(){var contextMenuHeight=angular.element("#context-menu")[0].offsetHeight;clickEvent.clientY+contextMenuHeight<window.innerHeight&&contextMenuHeight>2?angular.element("#context-menu").css("top",clickEvent.clientY+"px"):angular.element("#context-menu").css("top",clickEvent.clientY-contextMenuHeight+"px");var contextMenuWidth=angular.element("#context-menu")[0].offsetWidth;clickEvent.clientX+contextMenuWidth<window.innerWidth?angular.element("#context-menu").css("left",clickEvent.clientX+"px"):angular.element("#context-menu").css("left",clickEvent.clientX-contextMenuWidth+"px"),angular.element("#context-menu").removeClass("opacity-0")}$timeout(callBack,10)},$scope.loseFocusForElement=function(elementSelector){angular.element(elementSelector)[0].blur()}}),mainModule.controller("navBarController",function($scope,$rootScope,$http,$interval,$timeout){function startRegularUpdateNotificationLabel(){$scope.intervalNotificationUpdate||($scope.intervalNotificationUpdate=$scope.$interval(queryNotificationService,localStorage.notificationPortalQueryPeriod)),$rootScope.$on("event:StopRefreshing",function(){stopRegularUpdateNotificationLabel()}),queryNotificationService()}function stopRegularUpdateNotificationLabel(){$interval.cancel($scope.intervalNotificationUpdate),$scope.intervalNotificationUpdate=void 0}function queryNotificationService(){var eventsUrlPrefix=JSON.parse(localStorage.notificationServiceUrl)+"notifications/unreadCount";$http.get(eventsUrlPrefix,{headers:{sessionID:getSessionId()}}).success(function(response){Number.isInteger(response)&&($scope.nbNewNotifications=response)}).error(function(response){console.error("Error while querying notification service: ",response),null!==response&&401===response.httpErrorCode&&($scope.closeSession(),$rootScope.serverIsDown=!0)})}function setDefaultSelectedLanguage(language){var lang=$("#"+language).text(),flagObject=$("#"+language).find("img").attr("src"),flag='<img alt="'+language+'"style="height:25px;padding-left: 0px;padding-right: 5px;padding-top: 4px;padding-bottom: 4px;" src="'+flagObject+'"/>';$("#selected").html(flag+lang)}this.$onInit=function(){var jobAnalyticsChildren=["health-dashboard","job-analytics","job-gantt","node-gantt"],jobPlannerChildren=["job-planner-calendar-def","job-planner-calendar-def-workflows","job-planner-execution-planning","job-planner-gantt-chart"];$timeout(function(){var splitUrl=window.location.hash.split("/"),portal=splitUrl[splitUrl.length-1];setDefaultSelectedLanguage(localStorage.proactiveLanguage),-1!==jobAnalyticsChildren.indexOf(portal)?$scope.changeFavicon("analytics-portal"):-1!==jobPlannerChildren.indexOf(portal)?$scope.changeFavicon("job-planner-portal"):"workflow-execution"===splitUrl[splitUrl.length-1]?$scope.changeFavicon("automation_dashboard_30"):$scope.changeFavicon(splitUrl[splitUrl.length-1])},1e3),$scope.view=JSON.parse(localStorage.configViews),$http.get("resources/config.json").success(function(response){$scope.dashboardVersion=response.proactiveDashboardVersion}).error(function(response){$scope.dashboardVersion="not available"}),$scope.nbNewNotifications=0,startRegularUpdateNotificationLabel(),$timeout(function(){localStorage.getItem("collapsePreference")&&"in"===localStorage.getItem("collapsePreference")&&$scope.collapseMenu()},2e3)},$scope.collapseMenu=function(){$("#collapse-menu").next().find("span").is(":visible")?($("#collapse-menu > a > i").removeClass("fa-angle-double-left"),$("#collapse-menu > a > i").addClass("fa-angle-double-right"),localStorage.setItem("collapsePreference","in")):($("#collapse-menu > a > i").removeClass("fa-angle-double-right"),$("#collapse-menu > a > i").addClass("fa-angle-double-left"),localStorage.setItem("collapsePreference","out")),$(".pace-done").toggleClass("mini-navbar")},$scope.changeFavicon=function(portal){var link=document.createElement("link"),oldLink=document.getElementById("favicon");link.id="favicon",link.rel="icon",link.href="styles/patterns/"+portal+".png",oldLink&&document.head.removeChild(oldLink),document.head.appendChild(link)},$scope.displayAbout=function(){var windowLocation=window.location,protocol=windowLocation.protocol,host=windowLocation.host,result=protocol+"//"+host+"/rest";$scope.restUrl=result,$scope.year=(new Date).getFullYear(),$("#about-modal").modal("show")},$scope.showAccountInfo=function(){var requestGetAccountInfoUrl=JSON.parse(localStorage.restUrl)+"/common/currentuserdata",config={headers:{sessionid:getSessionId()}};$http.get(requestGetAccountInfoUrl,config).then(function(result){$scope.accountUsername=result.data.userName,$scope.accountDomain=result.data.domain,$scope.accountGroups="";for(var i=0;i<result.data.groups.length;i++)$scope.accountGroups=$scope.accountGroups+result.data.groups[i],i<result.data.groups.length-1&&($scope.accountGroups=$scope.accountGroups+", ");$scope.accountTenant=result.data.tenant,$scope.accountAdminRoles="";for(var i=0;i<result.data.adminRoles.length;i++)$scope.accountAdminRoles=$scope.accountAdminRoles+result.data.adminRoles[i],i<result.data.adminRoles.length-1&&($scope.accountAdminRoles=$scope.accountAdminRoles+", ");$scope.accountPortalAccessPermissionDisplay="";for(var i=0;i<result.data.portalAccessPermissionDisplay.length;i++)$scope.accountPortalAccessPermissionDisplay=$scope.accountPortalAccessPermissionDisplay+result.data.portalAccessPermissionDisplay[i],i<result.data.portalAccessPermissionDisplay.length-1&&($scope.accountPortalAccessPermissionDisplay=$scope.accountPortalAccessPermissionDisplay+", ");return $("#account-modal").modal("show"),result.data})},$rootScope.$on("event:notificationsDestroyed",function(){startRegularUpdateNotificationLabel()}),$rootScope.$on("event:notificationsInitialized",function(){stopRegularUpdateNotificationLabel()}),$rootScope.$on("event:updatedNotificationsCount",function(event,data){$scope.nbNewNotifications=data.count}),this.$onDestroy=function(){angular.isDefined($scope.intervalNotificationUpdate)&&($interval.cancel($scope.intervalNotificationUpdate),$scope.intervalNotificationUpdate=void 0)}}),mainModule.controller("loginController",function($scope,$http,$state,permissionService,$stateParams,$location,$rootScope){this.$onInit=function(){$scope.domains=[],$scope.getDomains()},$scope.redirectsTo=$stateParams.redirectsTo;var host=$location.host();$scope.showLinkAccountCreation="try.activeeon.com"===host||"azure-try.activeeon.com"===host;var username=getCookie("username");if("null"===username){var localStorageUser=localStorage["pa.login"];if(localStorageUser&&localStorageUser.includes("\\")){var domainUsername=localStorageUser.split("\\");$scope.selectedDomain=domainUsername[0],localStorageUser=domainUsername[1]}$scope.username=localStorageUser}else{if(username&&username.includes("\\")){var domainUsername=username.split("\\");$scope.selectedDomain=domainUsername[0],username=domainUsername[1]}$scope.username=username}$scope.login=function(){var username=$scope.username;$scope.selectedDomain&&(username=$scope.selectedDomain+"\\"+$scope.username);var password=$scope.password;localStorage["pa.login"]=username,$scope.main.userName=localStorage["pa.login"],permissionService.doLogin(username,password).success(function(response){var sessionid=getSessionId();sessionid&&$scope.determineFirstAuthorizedPortalAndAllPortalsAccessPermission($scope.redirectsTo),$scope.startRegularCheckSession(),$rootScope.serverIsDown=!1}).error(function(response){try{var error=JSON.parse(response);$rootScope.errorMessage=error.errorMessage,404===error.httpErrorCode&&error.stackTrace.indexOf("login.LoginException")<0&&($rootScope.errorMessage="The server is not available, please try again later.")}catch(e){$rootScope.errorMessage="Please try again later."}})},$scope.getDomains=function(){$http.get(JSON.parse(localStorage.schedulerRestUrl)+"domains/").then(function(response){$scope.domains=response.data,$scope.domains.length&&!$scope.domains.includes("")&&$scope.domains.unshift(""),$scope.domains.length?$scope.selectedDomain=$scope.domains[0]:$scope.selectedDomain=""})["catch"](function(response){console.error("Error getting domains:",response)})}}),mainModule.controller("logoutController",function($scope,$state){$scope.logout=function(){$("#confirm-logout-modal").modal("show")},$scope.confirmLogout=function(){$("#confirm-logout-modal").modal("hide"),$scope.disconnect(),$scope.closeSession()}}),mainModule.controller("footerController",function($scope){$scope.year=(new Date).getFullYear()}),mainModule.directive("ngRightClick",function($parse){return{restrict:"A",link:{pre:function(scope,element,attrs){var fn=$parse(attrs.ngRightClick);element.bind("contextmenu",function(event){scope.$apply(function(scope){event.preventDefault(),scope.contextMenuData&&(scope.contextMenuData.job=scope.job,scope.contextMenuData.subsLevel=scope.subsLevel),""!==attrs.ngRightClick&&fn(scope,{$event:event})})})},post:function(scope,element,attrs){""!==attrs.ngRightClick&&element.bind("contextmenu",function(event){scope.moveContextualMenu(event);var contextMenu=document.querySelector(".calendar-list");contextMenu&&contextMenu.addEventListener("click",function(event){event.stopPropagation()})})}}}}),mainModule.directive("ngWheel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attr){var expr=$parse(attr.ngWheel);element.bind("wheel",function(event){scope.$apply(function(){expr(scope)})})}}}]),mainModule.directive("ngDraggable",function($document){return{restrict:"A",scope:{dragScope:"@ngDraggable"},link:function(scope,elem,attr){function mousemove(e){y=e.clientY-startY,x=e.clientX-startX,setPosition()}function mouseup(e){$document.unbind("mousemove",mousemove),$document.unbind("mouseup",mouseup)}function setPosition(){container&&(0>x?x=0:x>container.width-width&&(x=container.width-width),0>y?y=0:y>container.height-height&&(y=container.height-height)),elem.css({top:y+"px",left:x+"px"})}var startX,startY,container,x=0,y=0,width=50,height=50;elem.on("mousedown",function(e){e.preventDefault(),scope.dragScope&&(container=document.querySelector(scope.dragScope).getBoundingClientRect()),width=elem[0].offsetWidth,height=elem[0].offsetHeight,startX=e.clientX-elem[0].offsetLeft,startY=e.clientY-elem[0].offsetTop,$document.on("mousemove",mousemove),$document.on("mouseup",mouseup)})}}}),angular.module("main").controller("CatalogViewController",function($scope,$rootScope,$uibModal,$http,$filter,$translate,$timeout,$sce,toaster,WECatalogService,UtilsFactory){function updateWorkflowsMetadataList(){$scope.isObjectsLoading=!0;var kind=$scope.showPSAWorkflowsOnly?"Workflow/psa":"Workflow/standard";WECatalogService.getWorkflowsMetadataList($scope.workflowNameQuery,$scope.selectedBucket.name,kind).then(function(response){$scope.workflowsMetadataList=response,$timeout(function(){$scope.isObjectsLoading=!1},500),$scope.workflowsMetadataList.forEach(function(catalogObject){for(var metadataIndex=0;metadataIndex<catalogObject.object_key_values.length;metadataIndex++){var label=catalogObject.object_key_values[metadataIndex].label,key=catalogObject.object_key_values[metadataIndex].key,value=catalogObject.object_key_values[metadataIndex].value;"job_information"===label&&"visualization"===key&&(catalogObject.visualization=$sce.trustAsHtml(value))}})})}function loadBuckets(){const appCatalog=JSON.parse(localStorage.appCatalogBucketsUrl),sessionIdHeader={headers:{sessionid:getSessionId()},params:{kind:$scope.showPSAWorkflowsOnly?"Workflow/psa":"Workflow/standard",objectName:$scope.workflowNameQuery}};$scope.isBucketsLoading=!0,$scope.bucketsMetadataList=[],$http.get(appCatalog,sessionIdHeader).success(function(bucketList){if($scope.bucketsMetadataList=bucketList,$scope.workflowNameQuery&&($scope.bucketsMetadataList=$scope.bucketsMetadataList.filter(function(bucket){return bucket.objectCount})),$scope.bucketsMetadataList.length){const selectedBucketIndex=$scope.bucketsMetadataList.findIndex(function(bucket){return bucket.name===$scope.selectedBucketName});$scope.selectedBucketName&&-1!==selectedBucketIndex?($scope.selectedBucket=$scope.bucketsMetadataList[selectedBucketIndex],$scope.scrollToBucket()):($scope.selectedBucket=$scope.bucketsMetadataList[0],$scope.showPSAWorkflowsOnly||UtilsFactory.setUserPreference("submissionView.selectedBucketName",$scope.selectedBucket.name)),updateWorkflowsMetadataList()}else $scope.workflowsMetadataList=[];$scope.isBucketsLoading=!1}).error(function(response){console.error("loadbuckets : http.get buckets: "+response)})}this.$onInit=function(){$scope.workflowNameQuery="",$scope.selectedWorkflow=$scope.$parent.$parent.$parent.$parent.$parent.$parent.workflowToSubmit,$scope.WEUserPreferences=UtilsFactory.loadUserPreferences(),$scope.selectedBucketName=UtilsFactory.getUserPreference("submissionView.selectedBucketName"),$scope.orderByColumnConfig=UtilsFactory.getUserPreference("submissionView.orderByColumnConfig.workflows"),$scope.OrderByBucketNameConfig=UtilsFactory.getUserPreference("submissionView.orderByColumnConfig.buckets"),$scope.toggleListBox=UtilsFactory.getUserPreference("submissionView.toggleListBox"),$scope.isBucketsLoading=!0,$scope.isObjectsLoading=!1,$timeout(function(){loadBuckets()},500)},$scope.getWorkflowPanelStatus=function(workflow){return $scope.selectedWorkflow&&workflow.name===$scope.selectedWorkflow.name?"panel-selected":"panel-default"},$scope.selectWorkflow=function(workflow){$scope.$parent.$parent.$parent.$parent.$parent.$parent.workflowToSubmit={variables:UtilsFactory.extractVariables(workflow),icon:UtilsFactory.getWorkflowMetadata(workflow,"generic_information","workflow.icon"),projectName:workflow.project_name,kind:workflow.kind,bucketName:UtilsFactory.getWorkflowMetadata(workflow,"generic_information","bucketName"),documentation:UtilsFactory.getWorkflowMetadata(workflow,"generic_information","Documentation"),description:UtilsFactory.getWorkflowMetadata(workflow,"General","description"),name:workflow.name,commitTime:workflow.commit_time,userName:workflow.username,submissionMode:workflow.submissionMode},$scope.selectedWorkflow=$scope.$parent.$parent.$parent.$parent.$parent.$parent.workflowToSubmit,$scope.$parent.$parent.$parent.$parent.$parent.$parent.activeTab.value=1},$scope.changeBucket=function(bucket){$scope.selectedBucket=bucket,$scope.showPSAWorkflowsOnly||UtilsFactory.setUserPreference("submissionView.selectedBucketName",$scope.selectedBucket.name),updateWorkflowsMetadataList()},$scope.scrollToBucket=function(){$timeout(function(){if($("#bucket"+$scope.selectedBucket.name).position()){var scrollToVal=$("#buckets-scroll-area").scrollTop()+$("#bucket"+$scope.selectedBucket.name).position().top-5;$("#buckets-scroll-area").scrollTop(scrollToVal)}},500)},$scope.filterObjectByObjectName=function(workflowNameQuery){$scope.workflowNameQuery=workflowNameQuery,$scope.selectedBucketName=UtilsFactory.getUserPreference("submissionView.selectedBucketName"),loadBuckets()},$scope.hideEmptyObject=function(bucket){return bucket.objectCount>0},$scope.findImageUrl=function(selectedWorkflow){var icon=UtilsFactory.getByKey("generic_information","workflow.icon",selectedWorkflow.object_key_values);return""===icon?"styles/patterns/img/wf-icons/wf-default-icon.png":icon},$scope.orderByColumn=function(column,config,propertyName){config.order=config.column!==column?"d":"a"===config.order?"d":"a",config.comparatorLogic=config.column!==column?"+"+column:"d"===config.order?"+"+column:"-"+column,config.column=column,UtilsFactory.setUserPreference(propertyName,config)},$scope.getSortClasses=function(sortParameters,column){return UtilsFactory.getSortClasses(sortParameters,column)},$scope.toggleDisplay=function(){UtilsFactory.setUserPreference("submissionView.toggleListBox",$scope.toggleListBox)},$scope.filterCreationWorkflows=function(workflow){return workflow.kind.toLowerCase().includes("workflow/standard")?!0:UtilsFactory.getWorkflowMetadata(workflow,"generic_information","pca.states")&&UtilsFactory.getWorkflowMetadata(workflow,"generic_information","pca.states").includes("VOID")},$scope.getObjectDescription=function(object){return UtilsFactory.getWorkflowMetadata(object,"General","description");
},$(document).keydown(function(e){27===e.keyCode&&$scope.isJobSubmissionPanelOpen&&$scope.toggleOpenSubmitJobPanel(!1)})}),angular.module("main").controller("VariablesController",function($scope,$uibModal,$http,$translate,$timeout,$sce,$rootScope,$location,toaster,PCAService,UtilsFactory,WESchedulerService){function createNewCdWfAssociation(){$scope.isSubmissionGoingOn=!0;const bucketName=$scope.workflow.bucketName;validateWorkflow(function(response){response.valid?(encryptValues(response),$scope.$parent.createAssociation($scope.workflow.name,bucketName,$scope.workflow.variables).success(function(res){$rootScope.$broadcast("event:updatePlannedJobsCount",res.id),$scope.desectWorkflowInModal(),$scope.toggleOpenSubmitJobPanel(!1),displaySuccessMessage("New association successfully created")}).error(function(res){$scope.isSubmissionGoingOn=!1,$scope.errorMessage=res.errorMessage,console.error("Error while creating calendar workflow association :",angular.toJson(res))})):($scope.isSubmissionGoingOn=!1,$scope.WEsubmissionErrorMessage=response.errorMessage,$scope.successMessage="")})}function scheduleWf(){$scope.isSubmissionGoingOn=!0,$scope.isSubmissionGoingOn=!0;$scope.workflow.bucketName;validateWorkflow(function(response){if(response.valid){encryptValues(response);var workflowVariables=constructVariablesObject($scope.workflow.variables),workflowVariables=UtilsFactory.parseEmptyVariablesValue(workflowVariables),newCdWf={calendar_bucket:$scope.workflow.calendar_bucket,calendar_name:$scope.workflow.calendar_name,workflow_bucket:$scope.workflow.bucketName,workflow_name:$scope.workflow.name,variables:workflowVariables},configHeaders={headers:{"Content-Type":"application/json",sessionid:getSessionId()}},data=JSON.stringify(newCdWf),url=JSON.parse(localStorage.jobPlannerServiceUrl)+"planned_jobs/";$http.post(url,data,configHeaders).success(function(res){$scope.toggleOpenSubmitJobPanel(!1),$scope.updateCurrentSelectedObjet(),displaySuccessMessage("New association successfully created")}).error(function(res){$scope.isSubmissionGoingOn=!1,$scope.errorMessage=res.errorMessage,console.error("Error while creating calendar workflow association :",angular.toJson(res))})}else $scope.isSubmissionGoingOn=!1,$scope.WEsubmissionErrorMessage=response.errorMessage,$scope.successMessage=""})}function updateCdWfAssociation(){$scope.isSubmissionGoingOn=!0,$scope.workflowVariables=UtilsFactory.parseEmptyVariablesValue($scope.workflow.variables),validateWorkflow(function(response){response.valid===!0?(encryptValues(response),$scope.$parent.updateCdWfAssociation($scope.workflow.variables).success(function(res){displaySuccessMessage("Association successfully updated"),$scope.updateLastSelectedWorkflow(),$scope.isSubmissionGoingOn=!1,$scope.toggleOpenSubmitJobPanel(!1)}).error(function(res){console.error("Error while updating calendar workflow association :",angular.toJson(res)),$scope.WEsubmissionErrorMessage=res.errorMessage,$scope.successMessage="",$scope.resetSelectedWorkflowVariableValues()})):($scope.isSubmissionGoingOn=!1,$scope.WEsubmissionErrorMessage=response.errorMessage,$scope.successMessage="",console.error("Error while updating the association : "+angular.toJson(response)),$scope.resetSelectedWorkflowVariableValues())})}function encryptValues(response){angular.forEach($scope.workflow.variables,function(variable){response.updatedModels[variable.name]&&"pa:hidden"===response.updatedModels[variable.name].toLowerCase()&&(variable.value=response.updatedVariables[variable.name])})}function constructVariablesObject(variables){var workflowVariables={};if(Array.isArray(variables))for(var i=0;i<variables.length;i++)workflowVariables[variables[i].name]=variables[i].value;else for(var i=0;i<Object.keys(variables).length;i++)workflowVariables[Object.keys(variables)[i]]=variables[Object.keys(variables)[i]].value;return workflowVariables}function validateWorkflow(successCallback,errorCallback){const bucketName=$scope.workflow.bucketName;UtilsFactory.validateWorkflow(bucketName,$scope.workflow.name,$scope.workflow.variables).success(function(response){successCallback(response)}).error(function(response){errorCallback?errorCallback(response):(UtilsFactory.displayTranslatedErrorMessage(["An error occurred while validating your workflow","\n","Please check the type of the provided values regarding the given variables models"]),console.error("An error occurred while validating the workflow: "+angular.toJson(response)))})}function validateJob(){WESchedulerService.validateJob($scope.workflow.variables,$scope.workflow.jobId).success(function(response){updateVariables(response),response.valid||($scope.WEsubmissionErrorMessage="",$scope.successMessage=""),UtilsFactory.replaceVariableModelsIfNeeded($scope.workflow.variables)}).error(function(response){UtilsFactory.displayTranslatedErrorMessage(["An error occurred while validating your job","\n","Please check the type of the provided values regarding the given variables models"]),console.error("An error occurred while validating the workflow: "+angular.toJson(response))})}function updateVariables(response){angular.forEach($scope.workflow.variables,function(variable){variable.model&&variable.resolvedModel&&(0===variable.model.toLowerCase().indexOf("pa:model_from_url")||variable.resolvedModel!==response.updatedModels[variable.name]&&(variable.value=0===response.updatedModels[variable.name].toLowerCase().indexOf("pa:boolean")?"false":"")),variable.resolvedModel=response.updatedModels[variable.name],variable.group=response.updatedGroups[variable.name]?response.updatedGroups[variable.name]:"",variable.advanced=response.updatedAdvanced[variable.name],variable.hidden=response.updatedHidden[variable.name],variable.description=response.updatedDescriptions[variable.name]?response.updatedDescriptions[variable.name]:""});for(var key in response.updatedVariables){var index=$scope.workflow.variables.findIndex(function(variable){return variable.name===key});if(key.indexOf(":")<0&&0>index){var globalVariable={name:key,value:response.updatedVariables[key],model:response.updatedModels[key],resolvedModel:response.updatedModels[key],group:response.updatedGroups[key]?response.updatedGroups[key]:"",advanced:response.updatedAdvanced[key],hidden:response.updatedHidden[key],description:response.updatedDescriptions[key]?response.updatedDescriptions[key]:""};$scope.workflow.variables.push(globalVariable)}}}function previous(){$scope.$parent.$parent.$parent.$parent.$parent.$parent.activeTab.value=0}function displaySuccessMessage(message){UtilsFactory.displayTranslatedMessage("success","Operation Successful !",message)}this.$onInit=function(){$scope.workflow=$scope.$parent.$parent.$parent.$parent.$parent.$parent.workflowToSubmit,$scope.toasterConfig={closeButton:!0,progressBar:!0};const variablesTemplateFooterButtonInfo=$scope.$parent.$parent.$parent.$parent.$parent.$parent.variablesTemplateFooterButtonInfo;$scope.WEsubmissionErrorMessage="",$scope.successMessage="",$scope.workflow.jobId?validateJob():validateWorkflow(function(response){updateVariables(response),UtilsFactory.replaceVariableModelsIfNeeded($scope.workflow.variables)}),$scope.footerActions={Submit:submit,Launch:submit,"Execute Action":submitServicesAndAction,Resubmit:function(){reSubmitJob($scope.workflow.id,$scope.workflow.variables)},"Kill & Re-Submit":function(){killResubmitJob($scope.workflow.id,$scope.workflow.variables)},"Confirm Association":createNewCdWfAssociation,"Schedule Workflow":scheduleWf,Update:updateCdWfAssociation,Previous:previous,Check:check,Cancel:function(){$scope.$parent.toggleOpenSubmitJobPanel(!1)}},$scope.footerTemplate=variablesTemplateFooterButtonInfo.map(function(item){return item.action=$scope.footerActions[item.label],item}),$scope.isSubmissionGoingOn=!1,$scope.pcaWorkflowLabel="",$scope.advancedVariables=!1},$scope.documentationUrlWfa=function(url){return url.startsWith("http")?url:JSON.parse(localStorage.appUrl).concat("/doc/",url)},$scope.isTextAreaModel=function(variable){return UtilsFactory.isTextAreaModel(variable)},$scope.isSpecialUIModel=function(variable){return UtilsFactory.isSpecialUIModel(variable)};const submitServicesAndAction=function(){$scope.isSubmissionGoingOn=!0;const bucketName=$scope.workflow.bucketName;validateWorkflow(function(response){if(response.valid===!0){const variables=UtilsFactory.parseEmptyVariablesValue(UtilsFactory.getVariablesInKeyValueFormat($scope.workflow.variables));if(UtilsFactory.getVariablesInKeyValueFormat($scope.workflow.variables),$scope.workflow.hasOwnProperty("isCreationWorkflow")&&!$scope.workflow.isCreationWorkflow){var httpPromise=PCAService.submitActionWorkflow($scope.workflow.serviceInstance.instance_id,bucketName,$scope.workflow.name,variables);httpPromise.then(function(){toaster.success("The action has been executed.",JSON.stringify(response.id)),$rootScope.$broadcast("event:updateServiceInstanceList"),$rootScope.$broadcast("event:updateWorkflowsGroupedByInstance"),$scope.isLoading=!1,$scope.$parent.toggleOpenSubmitJobPanel(!1)})["catch"](function(error){console.error("Error while executing workflow on instance "+$scope.workflow.serviceInstance.instance_id+": "+angular.toJson(error)),UtilsFactory.displayTranslatedErrorMessage("Error",["The action couldn't be executed:",error.data.httpErrorCode+" - "+error.data.errorMessage]),$scope.isLoading=!1})}else{var httpPromise=PCAService.submitCreationWorkflow($scope.workflow.bucketName,$scope.workflow.name,variables,$scope.pcaWorkflowLabel);httpPromise.then(function(){$scope.$parent.toggleOpenSubmitJobPanel(!1),toaster.success("The service instance has been created.",JSON.stringify(response.id))})["catch"](function(error){console.error("Error while submitting service: "+angular.toJson(error)),toaster.error("Error",["The service instance couldn't be created:",error.data.httpErrorCode+" - "+error.data.errorMessage])})}}else $scope.WEsubmissionErrorMessage=response.errorMessage,$scope.successMessage=""})},submit=function(){$scope.isSubmissionGoingOn=!0;const bucketName=$scope.workflow.bucketName;return $scope.workflow.kind.toLowerCase().includes("workflow/psa")?void submitServicesAndAction():void validateWorkflow(function(response){response.valid===!0?UtilsFactory.submitJob(bucketName,$scope.workflow.name,$scope.workflow.variables,$scope.workflow.submissionMode).success(function(submitResponse){$scope.$parent.toggleOpenSubmitJobPanel(!1),$scope.isSubmissionGoingOn=!1,"catalog"===$scope.workflow.submissionMode?toaster.pop("success","","Your Workflow has been submitted successfully , Job Id:"+JSON.stringify(submitResponse.id)+'<br><a href="/automation-dashboard/#/workflow-execution" target="_blank">Open Job in Workflow Execution Portal</a></br><a href="/scheduler" target="_blank">Open Job in Scheduler Portal</a>',5e3,"trustedHtml"):toaster.pop("success","","Your Workflow has been submitted successfully, Job Id: "+JSON.stringify(submitResponse.id),5e3,"trustedHtml")}).error(function(error){$scope.WEsubmissionErrorMessage=error.errorMessage,$scope.isSubmissionGoingOn=!1,toaster.error("An error occurred while submitting your workflow.\nPlease check you workflows and retry")}):($scope.WEsubmissionErrorMessage=response.errorMessage,$scope.isSubmissionGoingOn=!1,$scope.successMessage="")})},reSubmitJob=function(id,variables){$scope.isSubmissionGoingOn=!0,WESchedulerService.reSubmitJob(id,variables).success(function(response){$scope.$parent.toggleOpenSubmitJobPanel(!1),toaster.success("Job "+id+" resubmitted successfully!"),$scope.isSubmissionGoingOn=!1}).error(function(response){$scope.WEsubmissionErrorMessage=response.errorMessage,$scope.isSubmissionGoingOn=!1,console.error("Could not resubmit job "+id+"! "+response)})},killResubmitJob=function(id,variables){$scope.isSubmissionGoingOn=!0,WESchedulerService.reSubmitJob(id,variables).success(function(){WESchedulerService.killJob(id).success(function(res){res?toaster.success("Job "+id+" killed and resubmitted successfully!"):toaster.warning("Could not kill job "+id+"!"),$scope.$parent.toggleOpenSubmitJobPanel(!1),$scope.isSubmissionGoingOn=!1}).error(function(error){$scope.WEsubmissionErrorMessage=error.errorMessage,$scope.isSubmissionGoingOn=!1,console.error("Could not kill job "+id+"! "+res)})}).error(function(response){$scope.WEsubmissionErrorMessage=response.errorMessage,console.error("Could not resubmit job "+id+"! "+response),$scope.isSubmissionGoingOn=!1})},check=function(){validateWorkflow(function(response){angular.forEach($scope.workflow.variables,function(variable){variable.value=response.updatedVariables[variable.name]}),response.valid===!0?($scope.successMessage="Check success",$scope.WEsubmissionErrorMessage=""):($scope.WEsubmissionErrorMessage=response.errorMessage,$scope.successMessage="")})};$scope.validate=function(){$scope.workflow.jobId?validateJob():validateWorkflow(function(response){updateVariables(response),response.valid||($scope.WEsubmissionErrorMessage="",$scope.successMessage=""),UtilsFactory.replaceVariableModelsIfNeeded($scope.workflow.variables)})},$scope.modelToList=function(model){return UtilsFactory.modelToList(model)},$scope.modelToDateFormat=function(model){return UtilsFactory.modelToDateFormat(model)},$scope.modelToDateScope=function(model){return UtilsFactory.modelToDateScope(model)},$scope.manageThirdPartyCredentials=function(credVariable){validateWorkflow(function(response){var credVariableValue=response.updatedVariables[credVariable.name];UtilsFactory.openThirdPartyCredentialsModal(credVariableValue,check)},function(response){console.error("An error occurred while validating the workflow, so directly using the variable value as credential key. Error: "+angular.toJson(response)),UtilsFactory.openThirdPartyCredentialsModal(credVariable.value,check)})},$scope.manageFiles=function(variable,dataspace,selectFolder){UtilsFactory.openFileBrowser(variable,dataspace,selectFolder)},$scope.selectCatalogObjectVar=function(variable,variableModel){UtilsFactory.openCatalogObjectModal(variable,variableModel)},$scope.documentationUrl=function(url){return url.startsWith("http")?url:JSON.parse(localStorage.appUrl).concat("/doc/",url)},$scope.filterVariables=function(variable){return variable.hidden?!1:$scope.advancedVariables?!0:variable.advanced?!1:!0},$scope.isVariablesIncludeAdvancedVar=function(variables){return UtilsFactory.isVariablesIncludeAdvancedVar(variables)},$scope.cleanId=function(name){return name.replace(/ /g,"")},$scope.objectKeys=function(obj){return Object.keys(obj)},$(document).keydown(function(e){27===e.keyCode&&$scope.isJobSubmissionPanelOpen&&$scope.toggleOpenSubmitJobPanel(!1)})}),angular.module("main").factory("UtilsFactory",UtilsFactory),angular.module("main").filter("searchHighlight",searchHighlight).filter("dateTimeFormat",dateTimeFormat).filter("durationFormatWE",durationFormatWE).filter("escapeQuotes",escapeQuotes).filter("isDigit",isDigit).filter("getFirstLetter",getFirstLetter),angular.module("workflow-variables",[]).controller("ThirdPartyCredentialModalCtrl",function($scope,$uibModalInstance,toaster,SweetAlert,UtilsFactory,credKey){function loadThirdPartyCredentials(isReload){UtilsFactory.getThirdPartyCredentials().then(function(response){return $scope.thirdPartyCredentials=angular.copy(response.data),isReload&&credKey?void($scope.isVariableModelEditMode=!0):void(credKey&&$scope.thirdPartyCredentials.includes(credKey)?($scope.enableEditMode(credKey),$scope.isVariableModelEditMode=!0):($scope.newForm.key=credKey,$scope.isVariableModelEditMode=!1))})["catch"](function(response){console.error("Error while getting third party credentials: ",response),toaster.error(response.errorMessage?response.errorMessage:"Something went wrong!",403===response.httpErrorCode?"Permission denied!":"Cannot load third party credentials")})}$scope.isVariableModelEditMode=!!credKey,$scope.thirdPartyCredentials=[],$scope.newForm={key:"",value:""},$scope.editForm={key:"",value:""},$scope.isTextAreaMode=!1,$scope.isTextAreaEditMode=!1,$scope.isEditMode=!1,$scope.isReverseKeySort=!1,$scope.addNewCredential=function(key,value,isUpdateMode){UtilsFactory.postThirdPartyCredentials(key,value).then(function(response){loadThirdPartyCredentials(!0),toaster.success(isUpdateMode?"Credential "+key+"updated successfully!":"Credential "+key+"added successfully!"),isUpdateMode?$scope.editForm={key:"",value:""}:$scope.newForm={key:"",value:""}})["catch"](function(response){console.error("Error while getting third party credentials: ",response),toaster.error(response.errorMessage?response.errorMessage:"Something went wrong!",403===response.httpErrorCode?"Permission denied!":"Cannot create a or update third party credential "+key)})},$scope.editCredential=function(key,value){$scope.addNewCredential(key,value,!0),$scope.disableEditMode()},$scope.removeCredential=function(key){SweetAlert.swal({title:UtilsFactory.translate("Are you sure?"),text:UtilsFactory.translate("You are about to remove credential "+key),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:UtilsFactory.translate("Remove"),cancelButtonText:UtilsFactory.translate("Cancel"),closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&UtilsFactory.removeThirdPartyCredentials(key).then(function(response){loadThirdPartyCredentials(),toaster.success("Credential "+key+" removed successfully!")})["catch"](function(response){console.error("Error while getting third party credentials: ",response),toaster.error(response.errorMessage?response.errorMessage:"Something went wrong!",403===response.httpErrorCode?"Permission denied!":"Cannot remove third party credential "+key)})})},$scope.enableEditMode=function(key){$scope.isEditMode=!0,$scope.editForm.key=key,$scope.editForm.value=""},$scope.disableEditMode=function(){$scope.isEditMode=!1,$scope.editForm.key="",$scope.editForm.value=""},loadThirdPartyCredentials(),$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}),angular.module("workflow-variables").controller("FileBrowserModalCtrl",function($scope,$rootScope,$http,$uibModalInstance,$q,dataspace,variable,selectFolder,allowToEdit,SweetAlert,UtilsFactory){function displayGenericTitleErrorMessage(message){UtilsFactory.displayTranslatedErrorMessage("Oops!!!",message)}var dataspaceRestUrl=JSON.parse(localStorage.restUrl)+"/data/"+dataspace+"/",restRequestHeader={headers:{sessionid:getSessionId()}};switch($scope.currentPath="",$scope.allowToEdit=allowToEdit,$scope.locationDescription=UtilsFactory.translate(dataspace.toUpperCase()+" DataSpace"),$scope.title=UtilsFactory.translate(dataspace.toUpperCase()+" DataSpace File Browser"),dataspace.toUpperCase()){case"GLOBAL":$scope.spaceDescription=UtilsFactory.translate("Global DataSpace is a shared storage on the server host where anyone can read/write files."),$scope.isGlobalFile=!0;break;case"USER":$scope.spaceDescription=UtilsFactory.translate("User DataSpace is a personal user data storage."),$scope.isGlobalFile=!1;break;default:$scope.spaceDescription="",$scope.isGlobalFile=!1}$scope.variable=variable,$scope.selectFolder=selectFolder,$scope.showHiddenFiles=!1,$scope.filterValue="*",$scope.enterDir=function(event){$scope.currentPath=event.target.getAttribute("value"),$scope.refreshFiles()},$scope.showHiddenFilesChange=function(){$scope.refreshFiles()},$scope.enterFilesSubdir=function(event){var clickedRow=$(event.target.parentElement),clickedDir=clickedRow.children(".file-browser-dir");clickedDir&&(previousPath=$scope.currentPath,$scope.currentPath=clickedDir.attr("value"),$scope.refreshFiles(previousPath))},$scope.refreshFiles=function(previousPath){var pathname=$scope.currentPath;0==pathname.length&&(pathname="%2E");var url=dataspaceRestUrl+encodeURIComponent(pathname);$http.get(url+"?comp=list-metadata&includes="+$scope.filterValue,restRequestHeader).success(function(data){$scope.files=$scope.getFilesMetadata(data.fileListing,data),$scope.directories=$scope.getFilesMetadata(data.directoryListing,data)}).error(function(xhr){var errorMessage="";xhr&&(errorMessage=": "+xhr),displayGenericTitleErrorMessage(["Failed to access the path",pathname+errorMessage]),$scope.currentPath=previousPath?previousPath:$scope.currentPath})},$scope.getFilesMetadata=function(fileNames,response){var filesMetadata=[];return fileNames.forEach(function(filename,index){filesMetadata[index]={name:filename,type:response.types[filename],rights:response.permissions[filename],modified:$scope.toDateInClientFormat(response.lastModifiedDates[filename])},"DIRECTORY"!=filesMetadata[index].type&&(filesMetadata[index].size=UtilsFactory.toReadableFileSize(response.sizes[filename]))}),filesMetadata},$scope.toDateInClientFormat=function(serverDate){return new Date(serverDate).toLocaleString(void 0,{hour12:!1})},$scope.switchSelected=function(event){function darkenIcon(){var selectedElementIcon=$("#files-tbody  tr.active i");selectedElementIcon.hasClass("fa-file-o")?(selectedElementIcon.removeClass("fa-file-o"),selectedElementIcon.addClass("fa-file")):(selectedElementIcon.removeClass("fa-folder-o"),selectedElementIcon.addClass("fa-folder"))}function lightenIcon(){var selectedElementIcon=$("#files-tbody  tr.active i");selectedElementIcon.hasClass("fa-file")?(selectedElementIcon.removeClass("fa-file"),selectedElementIcon.addClass("fa-file-o")):(selectedElementIcon.removeClass("fa-folder"),selectedElementIcon.addClass("fa-folder-o"))}var targetRow=$(event.target.parentElement);if(targetRow.hasClass("active"))lightenIcon(),targetRow.removeClass("active");else{var selectedElement=$("#files-tbody  tr.active");selectedElement&&0!=selectedElement.length&&(lightenIcon(),selectedElement.removeClass("active")),targetRow.addClass("active"),darkenIcon(),$("#file-browser-error-message").text("")}},$scope.selectFile=function(){var selectedElement=$("#files-container tr.active");if(0==selectedElement.length)return void(selectFolder?$("#file-browser-error-message").text("Cannot find any folder selected: please select a folder !"):$("#file-browser-error-message").text("Cannot find any file selected: please select a regular file !"));var selectedFile,selectErrorMessage="";if(selectFolder?(selectedFile=selectedElement.children(".file-browser-dir"),selectErrorMessage="The regular file is disallowed to be the variable value: please select a directory !"):(selectedFile=selectedElement.children(".file-browser-file"),selectErrorMessage="The directory is disallowed to be the variable value: please select a regular file !"),0==selectedFile.length)$("#file-browser-error-message").text(selectErrorMessage);else{var selectedFilePath=selectedFile.attr("value");selectedFilePath.endsWith("/")&&(selectedFilePath=selectedFilePath.slice(0,-1)),variable.value=selectedFilePath,$scope.cancel()}},$scope.clickUpload=function(){$("#selected-upload-file").click()},$scope.fileSelected=function(){var element=document.getElementById("selected-upload-file"),selectedFile=element.files[0];if(selectedFile){var pathname=$scope.currentPath+selectedFile.name;if(selectedFile.name.includes(":"))return void UtilsFactory.displayTranslatedErrorMessage("Oops!!!",["Failed to upload the file ",selectedFile.name,":","it should not contain colon."]);var uploadURL=dataspaceRestUrl+encodeURIComponent(pathname);UtilsFactory.uploadDataspaceFile(uploadURL,selectedFile,$scope.isGlobalFile,function(data){$scope.refreshFiles()},function(){})}element.value=""},$scope.createFolder=function(){$("#files-tbody").prepend('<tr class="new-folder-li"><td> <i class="fa fa-folder-o"> </i> <input class="new-folder" value="untitled-folder"/> </td></tr>');var input=$(".new-folder"),value=input.val();input.focus().val("").blur().focus().val(value).select(),$(".new-folder").keyup(function(event){if($(this).is(":focus")&&"Enter"==event.key){var pathname=$scope.currentPath+$(this).val();if(pathname.includes(":"))return void displayGenericTitleErrorMessage(["Failed to create the new folder",pathname,":","it should not contain colon."]);$http({url:dataspaceRestUrl+encodeURIComponent(pathname),method:"POST",data:$.param({mimetype:"application/folder"}),headers:{sessionid:getSessionId(),"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$(".new-folder-li").remove(),$scope.refreshFiles()}).error(function(xhr){var errorMessage="";xhr&&(errorMessage=": "+xhr),displayGenericTitleErrorMessage("Failed to create the new folder",errorMessage)})}})},$scope.filterFiles=function(){""===$scope.filterValue&&($scope.filterValue="*"),$scope.refreshFiles()},$scope.downloadFile=function(){var selectedElement=$("#files-tbody  tr.active").children().first();if(0==selectedElement.length)return void displayGenericTitleErrorMessage("No file chosen to be downloaded.");var selectedFilePath=selectedElement.attr("value"),filename=selectedFilePath.match("([^/]*)/*$")[1];if(selectedElement.hasClass("file-browser-dir")){var confirmMessage=UtilsFactory.translate(["You are about to download the folder",'"'+filename+'"',"as a zip archive",'"'+filename+'.zip"',"proceed?"]);SweetAlert.swal({title:UtilsFactory.translate("Downloaded!"),text:confirmMessage,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:UtilsFactory.translate("Yes, download it!"),cancelButtonText:UtilsFactory.translate("Cancel"),closeOnConfirm:!1},function(isConfirm){console.log("confirm",isConfirm),isConfirm&&$scope.downloadFileRequest(selectedFilePath,filename+".zip","zip")})}else $scope.downloadFileRequest(selectedFilePath,filename,"identity")},$scope.downloadFileRequest=function(filePath,fileName,fileEncoding){$http({url:JSON.parse(localStorage.restUrl)+"/common/tokens?numberTokens=1",method:"POST",headers:{sessionid:getSessionId()}}).success(function(data){window.location.href=dataspaceRestUrl+encodeURIComponent(filePath)+"?encoding="+fileEncoding+"&token="+data[0]}).error(function(xhr){var errorMessage="";xhr&&(errorMessage=": "+xhr),displayGenericTitleErrorMessage("Failed to be authenticated for downloading the file "+fileName,errorMessage)})},$scope.deleteFile=function(){var confirmMessage,confirmButtonText,selectedElement=$("#files-tbody  tr.active").children().first(),selectedFilePath=selectedElement.attr("value");selectedElement.hasClass("file-browser-dir")?(confirmMessage=["Are you sure you want to permanently delete the folder",selectedFilePath,"and all the files in it ?"],confirmButtonText="Yes, delete folder!"):(confirmMessage=["Are you sure you want to permanently delete the file",selectedFilePath,"?"],confirmButtonText="Yes, delete file!"),SweetAlert.swal({title:UtilsFactory.translate("Deleted!"),text:UtilsFactory.translate(confirmMessage),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:UtilsFactory.translate(confirmButtonText),closeOnConfirm:!1},function(isConfirm){if(isConfirm){var url=dataspaceRestUrl+encodeURIComponent(selectedFilePath);$http["delete"](url,restRequestHeader).success(function(){$scope.refreshFiles(),UtilsFactory.displayTranslatedSuccessMessage("Deleted!",["Your",selectedFilePath,"file has been deleted."])}).error(function(xhr){var errorMessage="";xhr&&(errorMessage=": "+xhr),displayGenericTitleErrorMessage(["Failed to delete the file",selectedFilePath+errorMessage])})}})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")},$rootScope.cancelFileUpload=function(uploadId){var upload=$rootScope.uploadingCancelers.get(uploadId);if(upload){var confirmMessage=UtilsFactory.translate(["Are you sure you want to cancel uploading",upload.filename,"?"]);SweetAlert.swal({title:UtilsFactory.translate("Uploading!"),text:confirmMessage,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:UtilsFactory.translate("Yes, stop uploading!"),cancelButtonText:UtilsFactory.translate("Cancel"),closeOnConfirm:!0},function(isConfirm){isConfirm&&upload.canceler&&(upload.canceler.promise.status=499,upload.canceler.resolve())})}},$scope.refreshFiles()}),angular.module("workflow-variables").controller("CatalogObjectsModalCtrl",function($scope,$rootScope,$http,$uibModalInstance,variable,variableModel,SweetAlert,UtilsFactory){var restRequestHeader={headers:{sessionid:getSessionId()}},matches=variableModel.match(/\((.*)\)/);if(matches&&matches.length>1){var kindFilter,filterContentType,bucketNameFilter,objectNameFilter,params=matches[1].split(",");switch(params.length){case 4:objectNameFilter=params[3];case 3:bucketNameFilter=params[2];case 2:filterContentType=params[1];case 1:kindFilter=params[0]}}var kindFilterUrl=kindFilter?"kind="+encodeURIComponent(kindFilter):"",contentFilterUrl=filterContentType?"contentType="+encodeURIComponent(filterContentType):"",bucketNameFilterUrl=bucketNameFilter?"bucketName="+encodeURIComponent(bucketNameFilter):"",objectNameFilterUrl=objectNameFilter?"objectName="+encodeURIComponent(objectNameFilter):"",filterUrlParams=[kindFilterUrl,contentFilterUrl,bucketNameFilterUrl,objectNameFilterUrl].filter(function(x){return"string"==typeof x&&x.length>0}).join("&");$scope.updateBuckets=function(){$scope.clearData();var getBucketsUrl=JSON.parse(localStorage.appCatalogBucketsUrl);getBucketsUrl+="/?"+filterUrlParams,$http.get(getBucketsUrl,restRequestHeader).success(function(data){$scope.buckets=data,$scope.buckets&&$scope.buckets.length>0&&$scope.internalSelectBucket(0)}).error(function(xhr){var errorMessage="";xhr&&(errorMessage=": "+xhr),$scope.displayGenericTitleErrorMessage(["Failed to access the catalog",getBucketsUrl+errorMessage])})},$scope.internalSelectBucket=function(selectedIndex){if($scope.clearData(),$scope.selectedBucketIndex=selectedIndex,$scope.buckets&&!(selectedIndex>=$scope.buckets.length)){var bucketName=$scope.buckets[$scope.selectedBucketIndex].name,getCatalogObjectsUrl=JSON.parse(localStorage.appCatalogBucketsUrl)+"/"+bucketName+"/resources/?"+filterUrlParams;$http.get(getCatalogObjectsUrl,restRequestHeader).success(function(data){$scope.catalogObjects=data,$scope.catalogObjects&&$scope.catalogObjects.length>0&&$scope.internalSelectObject(0,bucketName)}).error(function(xhr){var errorMessage="";xhr&&(errorMessage=": "+xhr),$scope.displayGenericTitleErrorMessage(["Failed to access the catalog",getCatalogObjectsUrl+errorMessage])})}},$scope.internalSelectObject=function(selectedIndex,bucketName){$scope.revisions=void 0,$scope.revision=void 0,$scope.selectedCatalogObjectIndex=selectedIndex;var objectName=$scope.catalogObjects[selectedIndex].name,getRevisionsUrl=JSON.parse(localStorage.appCatalogBucketsUrl)+"/"+bucketName+"/resources/"+encodeURIComponent(objectName)+"/revisions";$http.get(getRevisionsUrl,restRequestHeader).success(function(data){$scope.revisions=data;var latestRevision=JSON.parse(JSON.stringify($scope.revisions[0]));latestRevision.links[1].href="buckets/"+latestRevision.bucket_name+"/resources/"+latestRevision.name,latestRevision.isLatest=!0,$scope.revisions.unshift(latestRevision),$scope.revisions&&$scope.internalSelectRevision(0)}).error(function(xhr){var errorMessage="";xhr&&(errorMessage=": "+xhr),$scope.displayGenericTitleErrorMessage(["Failed to access the catalog",getRevisionsUrl+errorMessage])})},$scope.internalSelectRevision=function(selectedIndex){$scope.selectedRevisionIndex=selectedIndex,$scope.revisions&&$scope.revisions[selectedIndex]&&($scope.revision=$scope.revisions[selectedIndex])},$scope.filterObjectByObjectName=function(){var objectNameFilterUrl=$scope.catalogObjectNameQuery?"objectName="+$scope.catalogObjectNameQuery:"";filterUrlParams=[kindFilterUrl,contentFilterUrl,objectNameFilterUrl].join("&"),$scope.updateBuckets()},$scope.clearData=function(){$scope.catalogObjects=void 0,$scope.revisions=void 0,$scope.revision=void 0},$scope.displayGenericTitleErrorMessage=function(message){UtilsFactory.displayTranslatedErrorMessage("Oops!!!",message)},$scope.selectCatalogObjectVariable=function(){if(!$scope.revision)return void UtilsFactory.displayTranslatedErrorMessage("Oops!!!","Please select a catalog object first.");var selectedObjectLink=$scope.revision.links[1].href,selectedObjectValue=selectedObjectLink.replace("buckets/","").replace("resources/","").replace("revisions/","");
variable.value=selectedObjectValue,$scope.cancel()},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")},$scope.updateBuckets()}),angular.module("workflow-variables").controller("WorkflowVisualizationModalGCPCtrl",function($scope,$uibModalInstance,workflow){$scope.workflow=workflow,$scope.visualization=workflow.visualization,$scope.catalogObjectKind=function(){return $scope.workflow.kind.slice(0,$scope.workflow.kind.indexOf("/"))},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")},$scope.isWorkflow=function(){return null!==$scope.workflow&&$scope.catalogObjectKind().toLowerCase().startsWith("workflow")},$scope.openStudio=function(){var url=JSON.parse(localStorage.studioUrl)+"/#workflowcatalog/"+workflow.bucket_name+"/workflow/"+workflow.name,win=window.open(url);win.focus()},$scope.exportVisu=function(){var elements=$(".workflow-visu").find("svg").map(function(){var svg=$(this),canvas=$("<canvas></canvas>").css({position:"absolute",left:svg.css("left"),top:svg.css("top")});svg.replaceWith(canvas);var content=svg.wrap("<p></p>").parent().html();return svg.unwrap(),canvg(canvas[0],content),{svg:svg,canvas:canvas}}),scrollHeight=$("#workflow-visualization-view").prop("scrollHeight");html2canvas($(".workflow-visu")[0],{allowTaint:!0,useCORS:!0,logging:!1,scale:2,height:scrollHeight,windowHeight:window.outerHeight+window.innerHeight}).then(function(canvas){elements.each(function(){this.canvas.replaceWith(this.svg)}),canvas.getContext("2d"),canvas.toBlob(function(blob){saveAs(blob,workflow.name+".png")})})}}),angular.module("workflow-variables").controller("WorkflowVisualizationController",WorkflowVisualizationController),function(){angular.module("inspinia",["ui.router","ui.bootstrap","main","angularMoment","angular-cron-gen","moment-picker","mwl.calendar","workflow-execution","gcp-rest","health-dashboard","job-analytics","job-gantt","job-gantt","ec-rest","calendar-association","execution-planning-rest","gantt-chart","cloud-watch","cloud-automation","notification-service","angularCSS","ui.codemirror","gantt","gantt.tooltips","ui.tree","gantt.tree","gantt.groups","gantt.corner"]).config(["momentPickerProvider",function(momentPickerProvider){momentPickerProvider.options({minutesFormat:"HH:mm"})}]).config(["calendarConfig",function(calendarConfig){calendarConfig.allDateFormats.moment.date.hour="HH:mm",calendarConfig.showTimesOnWeekView=!0}])}(),angular.module("inspinia").config(config).run(function($rootScope,$state,$interval,$http,$location){$rootScope.$state=$state,$rootScope.$interval=$interval}),angular.module("inspinia").config(function($httpProvider){$httpProvider.defaults.headers.common={},$httpProvider.defaults.headers.post={},$httpProvider.defaults.headers.put={},$httpProvider.defaults.headers.patch={},$httpProvider.defaults.headers.get={},$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"]}),angular.module("inspinia").run(function($rootScope,$state,$http,$location){$rootScope.$on("$locationChangeStart",function(event){localStorage.pcaServiceUrl&&localStorage.schedulerRestUrl&&localStorage.notificationServiceUrl&&localStorage.catalogServiceUrl&&localStorage.appCatalogWorkflowsUrl&&localStorage.appCatalogBucketsUrl&&localStorage.configViews&&localStorage.rmRestUrl&&localStorage.restUrl||getProperties($http,$location);var myDataPromise=isSessionValide($http,getSessionId(),$location);myDataPromise.then(function(result){return result||"/login"==$location.$$url?void 0:(event.preventDefault(),$rootScope.$broadcast("event:StopRefreshing"),$state.go("login",{redirectsTo:$location.$$url}))})})}),angular.module("inspinia").directive("iboxTools",iboxTools).directive("iboxToolsFullScreen",iboxToolsFullScreen).directive("icheck",icheck).directive("minimalizaSidebar",minimalizaSidebar).directive("pageTitle",pageTitle).directive("sideNavigation",sideNavigation).directive("slimScroll",slimScroll).directive("backTop",backToTop).directive("showDropdownFromTemplate",showDropdownFromTemplate).directive("inputFileChange",inputFileChange).directive("ellipsisTooltip",ellipsisTooltip).directive("copyClipBoard",copyClipBoard).directive("multiselectShiftKey",multiselectShiftKey).directive("uiSelectDirective",uiSelectDirective),angular.module("inspinia").controller("MainCtrl",MainCtrl);